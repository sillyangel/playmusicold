/*! For license information please see main.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==c){const e=a<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(e){return function(e){const r=t(e);return n.encodeByteArray(r,!0)}(e).replace(/\./g,"")},s=function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}const a=()=>{try{return o().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&s(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},c=e=>{var t,n;return null===(n=null===(t=a())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},u=()=>{var e;return null===(e=a())||void 0===e?void 0:e.config},l=e=>{var t;return null===(t=a())||void 0===t?void 0:t[`_${e}`]};class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function p(){try{return"object"==typeof indexedDB}catch(e){return!1}}function g(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function m(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class y extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,v.prototype.create)}}class v{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(w,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new y(r,o,n)}}const w=/\{\$([^}]+)}/g;function _(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(E(n)&&E(s)){if(!_(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function E(e){return null!==e&&"object"==typeof e}function b(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function I(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function T(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class S{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=C),void 0===r.error&&(r.error=C),void 0===r.complete&&(r.complete=C);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function C(){}const k=1e3,A=2,N=144e5,R=.5;function D(e,t=k,n=A){const r=t*Math.pow(n,e),i=Math.round(R*r*(Math.random()-.5)*2);return Math.min(N,r+i)}function P(e){return e&&e._delegate?e._delegate:e}class O{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const L="[DEFAULT]";class M{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new h;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:L})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=L){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=L){return this.instances.has(e)}getOptions(e=L){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===L?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=L){return this.component?this.component.multipleInstances?e:L:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class x{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new M(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const U=[];var F,V;(V=F||(F={}))[V.DEBUG=0]="DEBUG",V[V.VERBOSE=1]="VERBOSE",V[V.INFO=2]="INFO",V[V.WARN=3]="WARN",V[V.ERROR=4]="ERROR",V[V.SILENT=5]="SILENT";const j={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},B=F.INFO,$={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},q=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=$[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class z{constructor(e){this.name=e,this._logLevel=B,this._logHandler=q,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?j[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}const K=(e,t)=>t.some((t=>e instanceof t));let H,G;const W=new WeakMap,Q=new WeakMap,J=new WeakMap,X=new WeakMap,Y=new WeakMap;let Z={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Q.get(e);if("objectStoreNames"===t)return e.objectStoreNames||J.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return te(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ee(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(G||(G=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ne(this),e),te(W.get(this))}:function(...e){return te(t.apply(ne(this),e))}:function(e,...n){const r=t.call(ne(this),e,...n);return J.set(r,e.sort?e.sort():[e]),te(r)}:(e instanceof IDBTransaction&&function(e){if(Q.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Q.set(e,t)}(e),K(e,H||(H=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Z):e);var t}function te(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(te(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&W.set(t,e)})).catch((()=>{})),Y.set(t,e),t}(e);if(X.has(e))return X.get(e);const t=ee(e);return t!==e&&(X.set(e,t),Y.set(t,e)),t}const ne=e=>Y.get(e),re=["get","getKey","getAll","getAllKeys","count"],ie=["put","add","delete","clear"],se=new Map;function oe(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(se.get(t))return se.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=ie.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!re.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return se.set(t,s),s}var ae;ae=Z,Z={...ae,get:(e,t,n)=>oe(e,t)||ae.get(e,t,n),has:(e,t)=>!!oe(e,t)||ae.has(e,t)};class ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ue="@firebase/app",le="0.9.20",he=new z("@firebase/app"),de="[DEFAULT]",fe={[ue]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},pe=new Map,ge=new Map;function me(e,t){try{e.container.addComponent(t)}catch(n){he.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ye(e){const t=e.name;if(ge.has(t))return he.debug(`There were multiple attempts to register component ${t}.`),!1;ge.set(t,e);for(const t of pe.values())me(t,e);return!0}function ve(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const we=new v("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class _e{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new O("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw we.create("app-deleted",{appName:this._name})}}const Ee="10.5.0";function be(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:de,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw we.create("bad-app-name",{appName:String(i)});if(n||(n=u()),!n)throw we.create("no-options");const s=pe.get(i);if(s){if(_(n,s.options)&&_(r,s.config))return s;throw we.create("duplicate-app",{appName:i})}const o=new x(i);for(const e of ge.values())o.addComponent(e);const a=new _e(n,r,o);return pe.set(i,a),a}function Ie(e=de){const t=pe.get(e);if(!t&&e===de&&u())return be();if(!t)throw we.create("no-app",{appName:e});return t}function Te(e,t,n){var r;let i=null!==(r=fe[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void he.warn(e.join(" "))}ye(new O(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Se="firebase-heartbeat-database",Ce=1,ke="firebase-heartbeat-store";let Ae=null;function Ne(){return Ae||(Ae=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=te(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(te(o.result),e.oldVersion,e.newVersion,te(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Se,Ce,{upgrade:(e,t)=>{0===t&&e.createObjectStore(ke)}}).catch((e=>{throw we.create("idb-open",{originalErrorMessage:e.message})}))),Ae}async function Re(e,t){try{const n=(await Ne()).transaction(ke,"readwrite"),r=n.objectStore(ke);await r.put(t,De(e)),await n.done}catch(e){if(e instanceof y)he.warn(e.message);else{const t=we.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});he.warn(t.message)}}}function De(e){return`${e.name}!${e.options.appId}`}class Pe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Le(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Oe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Oe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Me(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Me(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=i(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Oe(){return(new Date).toISOString().substring(0,10)}class Le{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!p()&&g().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await Ne();return await t.transaction(ke).objectStore(ke).get(De(e))}catch(e){if(e instanceof y)he.warn(e.message);else{const t=we.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});he.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Re(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Me(e){return i(JSON.stringify({version:2,heartbeats:e})).length}function xe(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Ue(e){return void 0!==e&&void 0!==e.enterprise}ye(new O("platform-logger",(e=>new ce(e)),"PRIVATE")),ye(new O("heartbeat",(e=>new Pe(e)),"PRIVATE")),Te(ue,le,""),Te(ue,le,"esm2017"),Te("fire-js",""),Te("firebase","10.5.0","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;class Fe{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some((e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState))}}const Ve=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},je=new v("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Be=new z("@firebase/auth");function $e(e,...t){Be.logLevel<=F.ERROR&&Be.error(`Auth (${Ee}): ${e}`,...t)}function qe(e,...t){throw He(e,...t)}function ze(e,...t){return He(e,...t)}function Ke(e,t,n){const r=Object.assign(Object.assign({},Ve()),{[t]:n});return new v("auth","Firebase",r).create(t,{appName:e.name})}function He(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return je.create(e,...t)}function Ge(e,t,...n){if(!e)throw He(t,...n)}function We(e){const t="INTERNAL ASSERTION FAILED: "+e;throw $e(t),new Error(t)}function Qe(e,t){e||We(t)}function Je(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Xe(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Ye{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qe(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Xe()||"https:"===Xe()||f()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Ze(e,t){Qe(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class et{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void We("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void We("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void We("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const tt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},nt=new Ye(3e4,6e4);function rt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function it(e,t,n,r,i={}){return st(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=b(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),et.fetch()(at(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function st(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},tt),t);try{const t=new ct(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw ut(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ut(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ut(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw ut(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Ke(e,a,o);qe(e,a)}}catch(t){if(t instanceof y)throw t;qe(e,"network-request-failed",{message:String(t)})}}async function ot(e,t,n,r,i={}){const s=await it(e,t,n,r,i);return"mfaPendingCredential"in s&&qe(e,"multi-factor-auth-required",{_serverResponse:s}),s}function at(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Ze(e.config,i):`${e.config.apiScheme}://${i}`}class ct{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(ze(this.auth,"network-request-failed"))),nt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ut(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=ze(e,t,r);return i.customData._tokenResponse=n,i}function lt(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function ht(e){return 1e3*Number(e)}function dt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return $e("JWT malformed, contained fewer than 3 sections"),null;try{const e=s(n);return e?JSON.parse(e):($e("Failed to decode base64 JWT payload"),null)}catch(e){return $e("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function ft(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof y&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class pt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class gt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=lt(this.lastLoginAt),this.creationTime=lt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await ft(e,async function(e,t){return it(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Ge(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=xe(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new gt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class yt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ge(e.idToken,"internal-error"),Ge(void 0!==e.idToken,"internal-error"),Ge(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=dt(e);return Ge(t,"internal-error"),Ge(void 0!==t.exp,"internal-error"),Ge(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Ge(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await st(e,{},(async()=>{const n=b({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=at(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",et.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new yt;return n&&(Ge("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(Ge("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(Ge("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yt,this.toJSON())}_performRefresh(){return We("not implemented")}}function vt(e,t){Ge("string"==typeof e||void 0===e,"internal-error",{appName:t})}class wt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=xe(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new gt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await ft(this,this.stsTokenManager.getToken(this.auth,e));return Ge(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=P(e),r=await n.getIdToken(t),i=dt(r);Ge(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:lt(ht(i.auth_time)),issuedAtTime:lt(ht(i.iat)),expirationTime:lt(ht(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=P(e);await mt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new wt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await mt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ft(this,async function(e,t){return it(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:E,stsTokenManager:b}=t;Ge(v&&b,e,"internal-error");const I=yt.fromJSON(this.name,b);Ge("string"==typeof v,e,"internal-error"),vt(l,e.name),vt(h,e.name),Ge("boolean"==typeof w,e,"internal-error"),Ge("boolean"==typeof _,e,"internal-error"),vt(d,e.name),vt(f,e.name),vt(p,e.name),vt(g,e.name),vt(m,e.name),vt(y,e.name);const T=new wt({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:I,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(T.providerData=E.map((e=>Object.assign({},e)))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,n=!1){const r=new yt;r.updateFromServerResponse(t);const i=new wt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await mt(i),i}}const _t=new Map;function Et(e){Qe(e instanceof Function,"Expected a class definition");let t=_t.get(e);return t?(Qe(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,_t.set(e,t),t)}class bt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}bt.type="NONE";const It=bt;function Tt(e,t,n){return`firebase:${e}:${t}:${n}`}class St{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Tt(this.userKey,r.apiKey,i),this.fullPersistenceKey=Tt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?wt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new St(Et(It),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||Et(It);const s=Tt(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=wt._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new St(i,e,n)):new St(i,e,n)}}function Ct(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Rt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(kt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Pt(t))return"Blackberry";if(Ot(t))return"Webos";if(At(t))return"Safari";if((t.includes("chrome/")||Nt(t))&&!t.includes("edge/"))return"Chrome";if(Dt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function kt(e=d()){return/firefox\//i.test(e)}function At(e=d()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Nt(e=d()){return/crios\//i.test(e)}function Rt(e=d()){return/iemobile/i.test(e)}function Dt(e=d()){return/android/i.test(e)}function Pt(e=d()){return/blackberry/i.test(e)}function Ot(e=d()){return/webos/i.test(e)}function Lt(e=d()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Mt(e=d()){return Lt(e)||Dt(e)||Ot(e)||Pt(e)||/windows phone/i.test(e)||Rt(e)}function xt(e,t=[]){let n;switch(e){case"Browser":n=Ct(d());break;case"Worker":n=`${Ct(d())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ee}/${r}`}class Ut{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Ft{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Vt{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Bt(this),this.idTokenSubscription=new Bt(this),this.beforeStateQueue=new Ut(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=je,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Et(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await St.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mt(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?P(e):null;return t&&Ge(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Et(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return it(e,"GET","/v2/passwordPolicy",rt(e,t))}(this),t=new Ft(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new v("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Et(e)||this._popupRedirectResolver;Ge(t,this,"argument-error"),this.redirectPersistenceManager=await St.create(this,[Et(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ge(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=xt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Be.logLevel<=F.WARN&&Be.warn(`Auth (${Ee}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function jt(e){return P(e)}class Bt{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new S(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function $t(e){return new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=ze("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)}))}function qt(e){return`__${e}${Math.floor(1e6*Math.random())}`}class zt{constructor(e){this.type="recaptcha-enterprise",this.auth=jt(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;Ue(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return it(e,"GET","/v2/recaptchaConfig",rt(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new Fe(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&Ue(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));$t("https://www.google.com/recaptcha/enterprise.js?render="+i).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Kt(e,t,n,r=!1){const i=new zt(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}function Ht(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Gt(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Wt{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return We("not implemented")}_getIdTokenResponse(e){return We("not implemented")}_linkToIdToken(e,t){return We("not implemented")}_getReauthenticationResolver(e){return We("not implemented")}}async function Qt(e,t){return ot(e,"POST","/v1/accounts:signInWithPassword",rt(e,t))}async function Jt(e,t){return async function(e,t){return it(e,"POST","/v1/accounts:sendOobCode",rt(e,t))}(e,t)}class Xt extends Wt{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Xt(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Xt(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await Kt(e,n,"signInWithPassword");return Qt(e,t)}return Qt(e,n).catch((async t=>{if("auth/missing-recaptcha-token"===t.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await Kt(e,n,"signInWithPassword");return Qt(e,t)}return Promise.reject(t)}));case"emailLink":return async function(e,t){return ot(e,"POST","/v1/accounts:signInWithEmailLink",rt(e,t))}(e,{email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return it(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return ot(e,"POST","/v1/accounts:signInWithEmailLink",rt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:qe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Yt(e,t){return ot(e,"POST","/v1/accounts:signInWithIdp",rt(e,t))}class Zt extends Wt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zt(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):qe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=xe(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Zt(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Yt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Yt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Yt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=b(t)}return e}}const en={USER_NOT_FOUND:"user-not-found"};class tn extends Wt{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new tn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new tn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return ot(e,"POST","/v1/accounts:signInWithPhoneNumber",rt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await ot(e,"POST","/v1/accounts:signInWithPhoneNumber",rt(e,t));if(n.temporaryProof)throw ut(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return ot(e,"POST","/v1/accounts:signInWithPhoneNumber",rt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),en)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new tn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class nn{constructor(e){var t,n,r,i,s,o;const a=I(T(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Ge(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=I(T(e)).link,n=t?I(T(t)).deep_link_id:null,r=I(T(e)).deep_link_id;return(r?I(T(r)).link:null)||r||n||t||e}(e);try{return new nn(t)}catch(e){return null}}}class rn{constructor(){this.providerId=rn.PROVIDER_ID}static credential(e,t){return Xt._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=nn.parseLink(t);return Ge(n,"argument-error"),Xt._fromEmailAndCode(e,n.code,n.tenantId)}}rn.PROVIDER_ID="password",rn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",rn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class sn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class on extends sn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class an extends on{constructor(){super("facebook.com")}static credential(e){return Zt._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch(e){return null}}}an.FACEBOOK_SIGN_IN_METHOD="facebook.com",an.PROVIDER_ID="facebook.com";class cn extends on{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zt._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return cn.credential(t,n)}catch(e){return null}}}cn.GOOGLE_SIGN_IN_METHOD="google.com",cn.PROVIDER_ID="google.com";class un extends on{constructor(){super("github.com")}static credential(e){return Zt._fromParams({providerId:un.PROVIDER_ID,signInMethod:un.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return un.credentialFromTaggedObject(e)}static credentialFromError(e){return un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return un.credential(e.oauthAccessToken)}catch(e){return null}}}un.GITHUB_SIGN_IN_METHOD="github.com",un.PROVIDER_ID="github.com";class ln extends on{constructor(){super("twitter.com")}static credential(e,t){return Zt._fromParams({providerId:ln.PROVIDER_ID,signInMethod:ln.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ln.credentialFromTaggedObject(e)}static credentialFromError(e){return ln.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ln.credential(t,n)}catch(e){return null}}}async function hn(e,t){return ot(e,"POST","/v1/accounts:signUp",rt(e,t))}ln.TWITTER_SIGN_IN_METHOD="twitter.com",ln.PROVIDER_ID="twitter.com";class dn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await wt._fromIdTokenResponse(e,n,r),s=fn(n);return new dn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=fn(n);return new dn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function fn(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class pn extends y{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,pn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new pn(e,t,n,r)}}function gn(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw pn._fromErrorAndOperation(e,n,t,r);throw n}))}async function mn(e,t,n=!1){const r="signIn",i=await gn(e,r,t),s=await dn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function yn(e){const t=jt(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const vn="__sak";class wn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(vn,"1"),this.storage.removeItem(vn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class _n extends wn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=d();return At(e)||Lt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Mt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);!function(){const e=d();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||i===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}_n.type="LOCAL";const En=_n;class bn extends wn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}bn.type="SESSION";const In=bn;class Tn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Tn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Sn(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Tn.receivers=[];class Cn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Sn("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function kn(){return window}function An(){return void 0!==kn().WorkerGlobalScope&&"function"==typeof kn().importScripts}const Nn="firebaseLocalStorageDb",Rn="firebaseLocalStorage",Dn="fbase_key";class Pn{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function On(e,t){return e.transaction([Rn],t?"readwrite":"readonly").objectStore(Rn)}function Ln(){const e=indexedDB.open(Nn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Rn,{keyPath:Dn})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Rn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Nn);return new Pn(e).toPromise()}(),t(await Ln()))}))}))}async function Mn(e,t,n){const r=On(e,!0).put({[Dn]:t,value:n});return new Pn(r).toPromise()}function xn(e,t){const n=On(e,!0).delete(t);return new Pn(n).toPromise()}class Un{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Ln()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return An()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Tn._getInstance(An()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Cn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ln();return await Mn(e,vn,"1"),await xn(e,vn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Mn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=On(e,!1).get(t),r=await new Pn(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>xn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=On(e,!1).getAll();return new Pn(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Un.type="LOCAL";const Fn=Un;qt("rcb"),new Ye(3e4,6e4);class Vn{constructor(e){this.providerId=Vn.PROVIDER_ID,this.auth=jt(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const i=await n.verify();try{let s;if(Ge("string"==typeof i,e,"argument-error"),Ge("recaptcha"===n.type,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){Ge("enroll"===t.type,e,"internal-error");const n=await function(e,t){return it(e,"POST","/v2/accounts/mfaEnrollment:start",rt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{Ge("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;Ge(n,e,"missing-multi-factor-info");const o=await function(e,t){return it(e,"POST","/v2/accounts/mfaSignIn:start",rt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return it(e,"POST","/v1/accounts:sendVerificationCode",rt(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}(this.auth,e,P(t))}static credential(e,t){return tn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Vn.credentialFromTaggedObject(t)}static credentialFromError(e){return Vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?tn._fromTokenResponse(t,n):null}}function jn(e,t){return t?Et(t):(Ge(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Vn.PROVIDER_ID="phone",Vn.PHONE_SIGN_IN_METHOD="phone";class Bn extends Wt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Yt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Yt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Yt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function $n(e){return mn(e.auth,new Bn(e),e.bypassAuthState)}function qn(e){const{auth:t,user:n}=e;return Ge(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await ft(e,gn(r,i,t,e),n);Ge(s.idToken,r,"internal-error");const o=dt(s.idToken);Ge(o,r,"internal-error");const{sub:a}=o;return Ge(e.uid===a,r,"user-mismatch"),dn._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&qe(r,"user-mismatch"),e}}(n,new Bn(e),e.bypassAuthState)}async function zn(e){const{auth:t,user:n}=e;return Ge(n,t,"internal-error"),async function(e,t,n=!1){const r=await ft(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return dn._forOperation(e,"link",r)}(n,new Bn(e),e.bypassAuthState)}class Kn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $n;case"linkViaPopup":case"linkViaRedirect":return zn;case"reauthViaPopup":case"reauthViaRedirect":return qn;default:qe(this.auth,"internal-error")}}resolve(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Hn=new Ye(2e3,1e4);class Gn extends Kn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Gn.currentPopupAction&&Gn.currentPopupAction.cancel(),Gn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ge(e,this.auth,"internal-error"),e}async onExecution(){Qe(1===this.filter.length,"Popup operations only handle one event");const e=Sn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(ze(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Gn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Hn.get())};e()}}Gn.currentPopupAction=null;const Wn="pendingRedirect",Qn=new Map;class Jn extends Kn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Qn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Tt(Wn,e.config.apiKey,e.name)}(t),r=function(e){return Et(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Qn.set(this.auth._key(),e)}return this.bypassAuthState||Qn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Xn(e,t){Qn.set(e._key(),t)}async function Yn(e,t,n=!1){const r=jt(e),i=jn(r,t),s=new Jn(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Zn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!tr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(er(e))}saveEventToCache(e){this.cachedEventUids.add(er(e)),this.lastProcessedEventTime=Date.now()}}function er(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function tr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^https?/;function ir(e){const t=Je(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!rr.test(n))return!1;if(nr.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const sr=new Ye(3e4,6e4);function or(){const e=kn().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let ar=null;function cr(e){return ar=ar||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){or(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{or(),n(ze(e,"network-request-failed"))},timeout:sr.get()})}if(null===(i=null===(r=kn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=kn().gapi)||void 0===s?void 0:s.load)){const t=qt("iframefcb");return kn()[t]=()=>{gapi.load?o():n(ze(e,"network-request-failed"))},$t(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ar=null,e}))}(e),ar}const ur=new Ye(5e3,15e3),lr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function dr(e){const t=e.config;Ge(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Ze(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Ee},i=hr.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${b(r).slice(1)}`}const fr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class pr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const gr=encodeURIComponent("fac");async function mr(e,t,n,r,i,s){Ge(e.config.authDomain,e,"auth-domain-config-required"),Ge(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Ee,eventId:i};if(t instanceof sn){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof on){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${gr}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?Ze(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${b(a).slice(1)}${u}`}const yr="webStorageSupport",vr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=In,this._completeRedirectFn=Yn,this._overrideRedirectResult=Xn}async _openPopup(e,t,n,r){var i;return Qe(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},fr),{width:r.toString(),height:i.toString(),top:s,left:o}),u=d().toLowerCase();n&&(a=Nt(u)?"_blank":n),kt(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=d()){var t;return Lt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new pr(null);const h=window.open(t||"",a,l);Ge(h,e,"popup-blocked");try{h.focus()}catch(e){}return new pr(h)}(e,await mr(e,t,n,Je(),r),Sn())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await mr(e,t,n,Je(),r),kn().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Qe(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await cr(e),n=kn().gapi;return Ge(n,e,"internal-error"),t.open({where:document.body,url:dr(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lr,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=ze(e,"network-request-failed"),s=kn().setTimeout((()=>{r(i)}),ur.get());function o(){kn().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Zn(e);return t.register("authEvent",(t=>(Ge(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yr,{type:yr},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[yr];void 0!==i&&t(!!i),qe(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return it(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(ir(e))return}catch(e){}qe(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Mt()||At()||Lt()}};var wr="@firebase/auth",_r="1.3.0";class Er{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const br=l("authIdTokenMaxAge")||300;let Ir=null;var Tr;Tr="Browser",ye(new O("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Ge(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:Tr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:xt(Tr)},c=new Vt(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Et);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ye(new O("auth-internal",(e=>{return t=jt(e.getProvider("auth").getImmediate()),new Er(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),Te(wr,_r,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Tr)),Te(wr,_r,"esm2017");var Sr,Cr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},kr={},Ar=Ar||{},Nr=Cr||self;function Rr(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Dr(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Pr="closure_uid_"+(1e9*Math.random()>>>0),Or=0;function Lr(e,t,n){return e.call.apply(e.bind,arguments)}function Mr(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function xr(e,t,n){return(xr=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Lr:Mr).apply(null,arguments)}function Ur(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Fr(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function Vr(){this.s=this.s,this.o=this.o}Vr.prototype.s=!1,Vr.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Pr)&&e[Pr]||(e[Pr]=++Or))},Vr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jr=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Br(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function $r(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Rr(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function qr(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}qr.prototype.h=function(){this.defaultPrevented=!0};var zr=function(){if(!Nr.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Nr.addEventListener("test",(()=>{}),t),Nr.removeEventListener("test",(()=>{}),t)}catch(e){}return e}();function Kr(e){return/^[\s\xa0]*$/.test(e)}function Hr(){var e=Nr.navigator;return e&&(e=e.userAgent)?e:""}function Gr(e){return-1!=Hr().indexOf(e)}function Wr(e){return Wr[" "](e),e}Wr[" "]=function(){};var Qr,Jr,Xr,Yr=Gr("Opera"),Zr=Gr("Trident")||Gr("MSIE"),ei=Gr("Edge"),ti=ei||Zr,ni=Gr("Gecko")&&!(-1!=Hr().toLowerCase().indexOf("webkit")&&!Gr("Edge"))&&!(Gr("Trident")||Gr("MSIE"))&&!Gr("Edge"),ri=-1!=Hr().toLowerCase().indexOf("webkit")&&!Gr("Edge");function ii(){var e=Nr.document;return e?e.documentMode:void 0}e:{var si="",oi=(Jr=Hr(),ni?/rv:([^\);]+)(\)|;)/.exec(Jr):ei?/Edge\/([\d\.]+)/.exec(Jr):Zr?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Jr):ri?/WebKit\/(\S+)/.exec(Jr):Yr?/(?:Version)[ \/]?(\S+)/.exec(Jr):void 0);if(oi&&(si=oi?oi[1]:""),Zr){var ai=ii();if(null!=ai&&ai>parseFloat(si)){Qr=String(ai);break e}}Qr=si}Nr.document&&Zr?Xr=ii()||parseInt(Qr,10)||void 0:Xr=void 0;var ci=Xr;function ui(e,t){if(qr.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ni){e:{try{Wr(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:li[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ui.$.h.call(this)}}Fr(ui,qr);var li={2:"touch",3:"pen",4:"mouse"};ui.prototype.h=function(){ui.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var hi="closure_listenable_"+(1e6*Math.random()|0),di=0;function fi(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++di,this.fa=this.ia=!1}function pi(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function gi(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function mi(e){const t={};for(const n in e)t[n]=e[n];return t}const yi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function vi(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<yi.length;t++)n=yi[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function wi(e){this.src=e,this.g={},this.h=0}function _i(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=jr(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(pi(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ei(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}wi.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Ei(e,t,r,i);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new fi(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var bi="closure_lm_"+(1e6*Math.random()|0),Ii={};function Ti(e,t,n,r,i){if(r&&r.once)return Ci(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ti(e,t[s],n,r,i);return null}return n=Oi(n),e&&e[hi]?e.O(t,n,Dr(r)?!!r.capture:!!r,i):Si(e,t,n,!1,r,i)}function Si(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=Dr(i)?!!i.capture:!!i,a=Di(e);if(a||(e[bi]=a=new wi(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=Ri;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)zr||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Ni(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ci(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ci(e,t[s],n,r,i);return null}return n=Oi(n),e&&e[hi]?e.P(t,n,Dr(r)?!!r.capture:!!r,i):Si(e,t,n,!0,r,i)}function ki(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ki(e,t[s],n,r,i);else r=Dr(r)?!!r.capture:!!r,n=Oi(n),e&&e[hi]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Ei(s=e.g[t],n,r,i))&&(pi(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=Di(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ei(t,n,r,i)),(n=-1<e?t[e]:null)&&Ai(n))}function Ai(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[hi])_i(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Ni(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Di(t))?(_i(n,e),0==n.h&&(n.src=null,t[bi]=null)):pi(e)}}}function Ni(e){return e in Ii?Ii[e]:Ii[e]="on"+e}function Ri(e,t){if(e.fa)e=!0;else{t=new ui(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Ai(e),e=n.call(r,t)}return e}function Di(e){return(e=e[bi])instanceof wi?e:null}var Pi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oi(e){return"function"==typeof e?e:(e[Pi]||(e[Pi]=function(t){return e.handleEvent(t)}),e[Pi])}function Li(){Vr.call(this),this.i=new wi(this),this.S=this,this.J=null}function Mi(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new qr(t,e);else if(t instanceof qr)t.target=t.target||e;else{var i=t;vi(t=new qr(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=xi(o,r,!0,t)&&i}if(i=xi(o=t.g=e,r,!0,t)&&i,i=xi(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=xi(o=t.g=n[s],r,!1,t)&&i}function xi(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&_i(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Fr(Li,Vr),Li.prototype[hi]=!0,Li.prototype.removeEventListener=function(e,t,n,r){ki(this,e,t,n,r)},Li.prototype.N=function(){if(Li.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)pi(n[r]);delete t.g[e],t.h--}}this.J=null},Li.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Li.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ui=Nr.JSON.stringify;function Fi(){var e=Ki;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Vi=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new ji),(e=>e.reset()));class ji{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Bi(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function $i(e){Nr.setTimeout((()=>{throw e}),0)}let qi,zi=!1,Ki=new class{constructor(){this.h=this.g=null}add(e,t){const n=Vi.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Hi=()=>{const e=Nr.Promise.resolve(void 0);qi=()=>{e.then(Gi)}};var Gi=()=>{for(var e;e=Fi();){try{e.h.call(e.g)}catch(e){$i(e)}var t=Vi;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}zi=!1};function Wi(e,t){Li.call(this),this.h=e||1,this.g=t||Nr,this.j=xr(this.qb,this),this.l=Date.now()}function Qi(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function Ji(e,t,n){if("function"==typeof e)n&&(e=xr(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=xr(e.handleEvent,e)}return 2147483647<Number(t)?-1:Nr.setTimeout(e,t||0)}function Xi(e){e.g=Ji((()=>{e.g=null,e.i&&(e.i=!1,Xi(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Fr(Wi,Li),(Sr=Wi.prototype).ga=!1,Sr.T=null,Sr.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Mi(this,"tick"),this.ga&&(Qi(this),this.start()))}},Sr.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Sr.N=function(){Wi.$.N.call(this),Qi(this),delete this.g};class Yi extends Vr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Xi(this)}N(){super.N(),this.g&&(Nr.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Zi(e){Vr.call(this),this.h=e,this.g={}}Fr(Zi,Vr);var es=[];function ts(e,t,n,r){Array.isArray(n)||(n&&(es[0]=n.toString()),n=es);for(var i=0;i<n.length;i++){var s=Ti(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function ns(e){gi(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ai(e)}),e),e.g={}}function rs(){this.g=!0}function is(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ui(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Zi.prototype.N=function(){Zi.$.N.call(this),ns(this)},Zi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},rs.prototype.Ea=function(){this.g=!1},rs.prototype.info=function(){};var ss={},os=null;function as(){return os=os||new Li}function cs(e){qr.call(this,ss.Ta,e)}function us(e){const t=as();Mi(t,new cs(t))}function ls(e,t){qr.call(this,ss.STAT_EVENT,e),this.stat=t}function hs(e){const t=as();Mi(t,new ls(t,e))}function ds(e,t){qr.call(this,ss.Ua,e),this.size=t}function fs(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Nr.setTimeout((function(){e()}),t)}ss.Ta="serverreachability",Fr(cs,qr),ss.STAT_EVENT="statevent",Fr(ls,qr),ss.Ua="timingevent",Fr(ds,qr);var ps={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},gs={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ms(){}function ys(e){return e.h||(e.h=e.i())}function vs(){}ms.prototype.h=null;var ws,_s={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Es(){qr.call(this,"d")}function bs(){qr.call(this,"c")}function Is(){}function Ts(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Zi(this),this.P=Cs,e=ti?125:void 0,this.V=new Wi(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Ss}function Ss(){this.i=null,this.g="",this.h=!1}Fr(Es,qr),Fr(bs,qr),Fr(Is,ms),Is.prototype.g=function(){return new XMLHttpRequest},Is.prototype.i=function(){return{}},ws=new Is;var Cs=45e3,ks={},As={};function Ns(e,t,n){e.L=1,e.v=Ws(qs(t)),e.s=n,e.S=!0,Rs(e,null)}function Rs(e,t){e.G=Date.now(),Ls(e),e.A=qs(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),ao(n.i,"t",r),e.C=0,n=e.l.J,e.h=new Ss,e.g=ca(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Yi(xr(e.Pa,e,e.g),e.O)),ts(e.U,e.g,"readystatechange",e.nb),t=e.I?mi(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),us(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.W,e.s)}function Ds(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function Ps(e,t,n){let r,i=!0;for(;!e.J&&e.C<n.length;){if(r=Os(e,n),r==As){4==t&&(e.o=4,hs(14),i=!1),is(e.j,e.m,null,"[Incomplete Response]");break}if(r==ks){e.o=4,hs(15),is(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}is(e.j,e.m,r,null),Vs(e,r)}Ds(e)&&r!=As&&r!=ks&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,hs(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ea(t),t.M=!0,hs(11))):(is(e.j,e.m,n,"[Invalid Chunked Response]"),Fs(e),Us(e))}function Os(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?As:(n=Number(t.substring(n,r)),isNaN(n)?ks:(r+=1)+n>t.length?As:(t=t.slice(r,r+n),e.C=r+n,t))}function Ls(e){e.Y=Date.now()+e.P,Ms(e,e.P)}function Ms(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=fs(xr(e.lb,e),t)}function xs(e){e.B&&(Nr.clearTimeout(e.B),e.B=null)}function Us(e){0==e.l.H||e.J||ra(e.l,e)}function Fs(e){xs(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Qi(e.V),ns(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Vs(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||go(n.i,e)))if(!e.K&&go(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;na(n),Ho(n)}Zo(n),hs(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=fs(xr(n.ib,n),6e3));if(1>=po(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else sa(n,11)}else if((e.K||n.g==e)&&na(n),!Kr(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(mo(s,s.h),s.h=null))}if(r.F){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Gs(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=aa(r,r.J?r.pa:null,r.Y),o.K){yo(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.B&&(xs(a),Ls(a)),r.g=o}else Yo(r);0<n.j.length&&Wo(n)}else"stop"!=u[0]&&"close"!=u[0]||sa(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?sa(n,7):Ko(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}us()}catch(e){}}function js(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Rr(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Rr(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Rr(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(Sr=Ts.prototype).setTimeout=function(e){this.P=e},Sr.nb=function(e){e=e.target;const t=this.M;t&&3==Vo(e)?t.l():this.Pa(e)},Sr.Pa=function(e){try{if(e==this.g)e:{const l=Vo(this.g);var t=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||ti||this.g&&(this.h.h||this.g.ja()||jo(this.g)))){this.J||4!=l||7==t||us(),xs(this);var n=this.g.da();this.ca=n;t:if(Ds(this)){var r=jo(this.g);e="";var i=r.length,s=4==Vo(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Fs(this),Us(this);var o="";break t}this.h.i=new Nr.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Kr(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,hs(12),Fs(this),Us(this);break e}is(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Vs(this,n)}this.S?(Ps(this,l,o),ti&&this.i&&3==l&&(ts(this.U,this.V,"tick",this.mb),this.V.start())):(is(this.j,this.m,o,null),Vs(this,o)),4==l&&Fs(this),this.i&&!this.J&&(4==l?ra(this.l,this):(this.i=!1,Ls(this)))}else(function(e){const t={};e=(e.g&&2<=Vo(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(Kr(e[r]))continue;var n=Bi(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,hs(12)):(this.o=0,hs(13)),Fs(this),Us(this)}}}catch(e){}},Sr.mb=function(){if(this.g){var e=Vo(this.g),t=this.g.ja();this.C<t.length&&(xs(this),Ps(this,e,t),this.i&&4!=e&&Ls(this))}},Sr.cancel=function(){this.J=!0,Fs(this)},Sr.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.L&&(us(),hs(17)),Fs(this),this.o=2,Us(this)):Ms(this,this.Y-e)};var Bs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $s(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof $s){this.h=e.h,zs(this,e.j),this.s=e.s,this.g=e.g,Ks(this,e.m),this.l=e.l;var t=e.i,n=new ro;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Hs(this,n),this.o=e.o}else e&&(t=String(e).match(Bs))?(this.h=!1,zs(this,t[1]||"",!0),this.s=Qs(t[2]||""),this.g=Qs(t[3]||"",!0),Ks(this,t[4]),this.l=Qs(t[5]||"",!0),Hs(this,t[6]||"",!0),this.o=Qs(t[7]||"")):(this.h=!1,this.i=new ro(null,this.h))}function qs(e){return new $s(e)}function zs(e,t,n){e.j=n?Qs(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ks(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Hs(e,t,n){t instanceof ro?(e.i=t,function(e,t){t&&!e.j&&(io(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(so(this,t),ao(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Js(t,to)),e.i=new ro(t,e.h))}function Gs(e,t,n){e.i.set(t,n)}function Ws(e){return Gs(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Qs(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Js(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Xs),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Xs(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}$s.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Js(t,Ys,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Js(t,Ys,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Js(n,"/"==n.charAt(0)?eo:Zs,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Js(n,no)),e.join("")};var Ys=/[#\/\?@]/g,Zs=/[#\?:]/g,eo=/[#\?]/g,to=/[#\?@]/g,no=/#/g;function ro(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function io(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function so(e,t){io(e),t=co(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function oo(e,t){return io(e),t=co(e,t),e.g.has(t)}function ao(e,t,n){so(e,t),0<n.length&&(e.i=null,e.g.set(co(e,t),Br(n)),e.h+=n.length)}function co(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Sr=ro.prototype).add=function(e,t){io(this),this.i=null,e=co(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Sr.forEach=function(e,t){io(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Sr.ta=function(){io(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},Sr.Z=function(e){io(this);let t=[];if("string"==typeof e)oo(this,e)&&(t=t.concat(this.g.get(co(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Sr.set=function(e,t){return io(this),this.i=null,oo(this,e=co(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Sr.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Sr.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")};var uo=class{constructor(e,t){this.g=e,this.map=t}};function lo(e){this.l=e||ho,e=Nr.PerformanceNavigationTiming?0<(e=Nr.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Nr.g&&Nr.g.Ka&&Nr.g.Ka()&&Nr.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ho=10;function fo(e){return!!e.h||!!e.g&&e.g.size>=e.j}function po(e){return e.h?1:e.g?e.g.size:0}function go(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function mo(e,t){e.g?e.g.add(t):e.h=t}function yo(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function vo(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Br(e.i)}lo.prototype.cancel=function(){if(this.i=vo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var wo=class{stringify(e){return Nr.JSON.stringify(e,void 0)}parse(e){return Nr.JSON.parse(e,void 0)}};function _o(){this.g=new wo}function Eo(e,t,n){const r=n||"";try{js(e,(function(e,n){let i=e;Dr(e)&&(i=Ui(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function bo(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Io(e){this.l=e.ec||null,this.j=e.ob||!1}function To(e,t){Li.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=So,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Fr(Io,ms),Io.prototype.g=function(){return new To(this.l,this.j)},Io.prototype.i=function(e){return function(){return e}}({}),Fr(To,Li);var So=0;function Co(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function ko(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ao(e)}function Ao(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Sr=To.prototype).open=function(e,t){if(this.readyState!=So)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ao(this)},Sr.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Nr).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Sr.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ko(this)),this.readyState=So},Sr.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ao(this)),this.g&&(this.readyState=3,Ao(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Nr.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Co(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Sr.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ko(this):Ao(this),3==this.readyState&&Co(this)}},Sr.Za=function(e){this.g&&(this.response=this.responseText=e,ko(this))},Sr.Ya=function(e){this.g&&(this.response=e,ko(this))},Sr.ka=function(){this.g&&ko(this)},Sr.setRequestHeader=function(e,t){this.v.append(e,t)},Sr.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Sr.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(To.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var No=Nr.JSON.parse;function Ro(e){Li.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Do,this.L=this.M=!1}Fr(Ro,Li);var Do="",Po=/^https?$/i,Oo=["POST","PUT"];function Lo(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Mo(e),Uo(e)}function Mo(e){e.F||(e.F=!0,Mi(e,"complete"),Mi(e,"error"))}function xo(e){if(e.h&&void 0!==Ar&&(!e.C[1]||4!=Vo(e)||2!=e.da()))if(e.v&&4==Vo(e))Ji(e.La,0,e);else if(Mi(e,"readystatechange"),4==Vo(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var i=String(e.I).match(Bs)[1]||null;!i&&Nr.self&&Nr.self.location&&(i=Nr.self.location.protocol.slice(0,-1)),r=!Po.test(i?i.toLowerCase():"")}n=r}if(n)Mi(e,"complete"),Mi(e,"success");else{e.m=6;try{var s=2<Vo(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",Mo(e)}}finally{Uo(e)}}}function Uo(e,t){if(e.g){Fo(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Mi(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Fo(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Nr.clearTimeout(e.A),e.A=null)}function Vo(e){return e.g?e.g.readyState:0}function jo(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Do:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Bo(e){let t="";return gi(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function $o(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Bo(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Gs(e,t,n))}function qo(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function zo(e){this.Ga=0,this.j=[],this.l=new rs,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=qo("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=qo("baseRetryDelayMs",5e3,e),this.hb=qo("retryDelaySeedMs",1e4,e),this.eb=qo("forwardChannelMaxRetries",2,e),this.xa=qo("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new lo(e&&e.concurrentRequestLimit),this.Ja=new _o,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Ko(e){if(Go(e),3==e.H){var t=e.W++,n=qs(e.I);if(Gs(n,"SID",e.K),Gs(n,"RID",t),Gs(n,"TYPE","terminate"),Jo(e,n),(t=new Ts(e,e.l,t)).L=2,t.v=Ws(qs(n)),n=!1,Nr.navigator&&Nr.navigator.sendBeacon)try{n=Nr.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&Nr.Image&&((new Image).src=t.v,n=!0),n||(t.g=ca(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Ls(t)}oa(e)}function Ho(e){e.g&&(ea(e),e.g.cancel(),e.g=null)}function Go(e){Ho(e),e.u&&(Nr.clearTimeout(e.u),e.u=null),na(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Nr.clearTimeout(e.m),e.m=null)}function Wo(e){if(!fo(e.i)&&!e.m){e.m=!0;var t=e.Na;qi||Hi(),zi||(qi(),zi=!0),Ki.add(t,e),e.C=0}}function Qo(e,t){var n;n=t?t.m:e.W++;const r=qs(e.I);Gs(r,"SID",e.K),Gs(r,"RID",n),Gs(r,"AID",e.V),Jo(e,r),e.o&&e.s&&$o(r,e.o,e.s),n=new Ts(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=Xo(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),mo(e.i,n),Ns(n,r,t)}function Jo(e,t){e.na&&gi(e.na,(function(e,n){Gs(t,n,e)})),e.h&&js({},(function(e,n){Gs(t,n,e)}))}function Xo(e,t,n){n=Math.min(e.j.length,n);var r=e.h?xr(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Eo(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function Yo(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;qi||Hi(),zi||(qi(),zi=!0),Ki.add(t,e),e.A=0}}function Zo(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=fs(xr(e.Ma,e),ia(e,e.A)),e.A++,0))}function ea(e){null!=e.B&&(Nr.clearTimeout(e.B),e.B=null)}function ta(e){e.g=new Ts(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=qs(e.wa);Gs(t,"RID","rpc"),Gs(t,"SID",e.K),Gs(t,"AID",e.V),Gs(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Gs(t,"TO",e.qa),Gs(t,"TYPE","xmlhttp"),Jo(e,t),e.o&&e.s&&$o(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=Ws(qs(t)),n.s=null,n.S=!0,Rs(n,e)}function na(e){null!=e.v&&(Nr.clearTimeout(e.v),e.v=null)}function ra(e,t){var n=null;if(e.g==t){na(e),ea(e),e.g=null;var r=2}else{if(!go(e.i,t))return;n=t.F,yo(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i=e.C;Mi(r=as(),new ds(r,n)),Wo(e)}else Yo(e);else if(3==(i=t.o)||0==i&&0<t.ca||!(1==r&&function(e,t){return!(po(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=fs(xr(e.Na,e,t),ia(e,e.C)),e.C++,0)))}(e,t)||2==r&&Zo(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:sa(e,5);break;case 4:sa(e,10);break;case 3:sa(e,6);break;default:sa(e,2)}}function ia(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function sa(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=xr(e.pb,e);n||(n=new $s("//www.google.com/images/cleardot.gif"),Nr.location&&"http"==Nr.location.protocol||zs(n,"https"),Ws(n)),function(e,t){const n=new rs;if(Nr.Image){const r=new Image;r.onload=Ur(bo,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Ur(bo,n,r,"TestLoadImage: error",!1,t),r.onabort=Ur(bo,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Ur(bo,n,r,"TestLoadImage: timeout",!1,t),Nr.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else hs(2);e.H=0,e.h&&e.h.za(t),oa(e),Go(e)}function oa(e){if(e.H=0,e.ma=[],e.h){const t=vo(e.i);0==t.length&&0==e.j.length||($r(e.ma,t),$r(e.ma,e.j),e.i.i.length=0,Br(e.j),e.j.length=0),e.h.ya()}}function aa(e,t,n){var r=n instanceof $s?qs(n):new $s(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Ks(r,r.m);else{var i=Nr.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new $s(null);r&&zs(s,r),t&&(s.g=t),i&&Ks(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&Gs(r,n,t),Gs(r,"VER",e.ra),Jo(e,r),r}function ca(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Ro(new Io({ob:!0})):new Ro(e.va)).Oa(e.J),t}function ua(){}function la(){if(Zr&&!(10<=Number(ci)))throw Error("Environmental error: no available transport.")}function ha(e,t){Li.call(this),this.g=new zo(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Kr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Kr(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new pa(this)}function da(e){Es.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function fa(){bs.call(this),this.status=1}function pa(e){this.g=e}function ga(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ma(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function ya(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(Sr=Ro.prototype).Oa=function(e){this.M=e},Sr.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ws.g(),this.C=this.u?ys(this.u):ys(ws),this.g.onreadystatechange=xr(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Lo(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=Nr.FormData&&e instanceof Nr.FormData,!(0<=jr(Oo,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Fo(this),0<this.B&&((this.L=function(e){return Zr&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xr(this.ua,this)):this.A=Ji(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Lo(this,e)}},Sr.ua=function(){void 0!==Ar&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Mi(this,"timeout"),this.abort(8))},Sr.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Mi(this,"complete"),Mi(this,"abort"),Uo(this))},Sr.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Uo(this,!0)),Ro.$.N.call(this)},Sr.La=function(){this.s||(this.G||this.v||this.l?xo(this):this.kb())},Sr.kb=function(){xo(this)},Sr.isActive=function(){return!!this.g},Sr.da=function(){try{return 2<Vo(this)?this.g.status:-1}catch(e){return-1}},Sr.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Sr.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),No(t)}},Sr.Ia=function(){return this.m},Sr.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Sr=zo.prototype).ra=8,Sr.H=1,Sr.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const i=new Ts(this,this.l,e);let s=this.s;if(this.U&&(s?(s=mi(s),vi(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Xo(this,i,t),Gs(n=qs(this.I),"RID",e),Gs(n,"CVER",22),this.F&&Gs(n,"X-HTTP-Session-Id",this.F),Jo(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Bo(s)))+"&"+t:this.o&&$o(n,this.o,s)),mo(this.i,i),this.bb&&Gs(n,"TYPE","init"),this.P?(Gs(n,"$req",t),Gs(n,"SID","null"),i.aa=!0,Ns(i,n,null)):Ns(i,n,t),this.H=2}}else 3==this.H&&(e?Qo(this,e):0==this.j.length||fo(this.i)||Qo(this))},Sr.Ma=function(){if(this.u=null,ta(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=fs(xr(this.jb,this),e)}},Sr.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,hs(10),Ho(this),ta(this))},Sr.ib=function(){null!=this.v&&(this.v=null,Ho(this),Zo(this),hs(19))},Sr.pb=function(e){e?(this.l.info("Successfully pinged google.com"),hs(2)):(this.l.info("Failed to ping google.com"),hs(1))},Sr.isActive=function(){return!!this.h&&this.h.isActive(this)},(Sr=ua.prototype).Ba=function(){},Sr.Aa=function(){},Sr.za=function(){},Sr.ya=function(){},Sr.isActive=function(){return!0},Sr.Va=function(){},la.prototype.g=function(e,t){return new ha(e,t)},Fr(ha,Li),ha.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;hs(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=aa(e,null,e.Y),Wo(e)},ha.prototype.close=function(){Ko(this.g)},ha.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Ui(e),e=n);t.j.push(new uo(t.fb++,e)),3==t.H&&Wo(t)},ha.prototype.N=function(){this.g.h=null,delete this.j,Ko(this.g),delete this.g,ha.$.N.call(this)},Fr(da,Es),Fr(fa,bs),Fr(pa,ua),pa.prototype.Ba=function(){Mi(this.g,"a")},pa.prototype.Aa=function(e){Mi(this.g,new da(e))},pa.prototype.za=function(e){Mi(this.g,new fa)},pa.prototype.ya=function(){Mi(this.g,"b")},Fr(ga,(function(){this.blockSize=-1})),ga.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ga.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)ma(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){ma(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){ma(this,r),i=0;break}}this.h=i,this.i+=t},ga.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var va={};function wa(e){return-128<=e&&128>e?function(e,t){var n=va;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new ya([0|e],0>e?-1:0)}(e)}(e):new ya([0|e],0>e?-1:0)}function _a(e){if(isNaN(e)||!isFinite(e))return ba;if(0>e)return ka(_a(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Ea;return new ya(t,0)}var Ea=4294967296,ba=wa(0),Ia=wa(1),Ta=wa(16777216);function Sa(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Ca(e){return-1==e.h}function ka(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new ya(n,~e.h).add(Ia)}function Aa(e,t){return e.add(ka(t))}function Na(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ra(e,t){this.g=e,this.h=t}function Da(e,t){if(Sa(t))throw Error("division by zero");if(Sa(e))return new Ra(ba,ba);if(Ca(e))return t=Da(ka(e),t),new Ra(ka(t.g),ka(t.h));if(Ca(t))return t=Da(e,ka(t)),new Ra(ka(t.g),t.h);if(30<e.g.length){if(Ca(e)||Ca(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Ia,r=t;0>=r.X(e);)n=Pa(n),r=Pa(r);var i=Oa(n,1),s=Oa(r,1);for(r=Oa(r,2),n=Oa(n,2);!Sa(r);){var o=s.add(r);0>=o.X(e)&&(i=i.add(n),s=o),r=Oa(r,1),n=Oa(n,1)}return t=Aa(e,i.R(t)),new Ra(i,t)}for(i=ba;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=_a(n)).R(t);Ca(o)||0<o.X(e);)o=(s=_a(n-=r)).R(t);Sa(s)&&(s=Ia),i=i.add(s),e=Aa(e,o)}return new Ra(i,e)}function Pa(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new ya(n,e.h)}function Oa(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new ya(i,e.h)}(Sr=ya.prototype).ea=function(){if(Ca(this))return-ka(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Ea+r)*t,t*=Ea}return e},Sr.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Sa(this))return"0";if(Ca(this))return"-"+ka(this).toString(e);for(var t=_a(Math.pow(e,6)),n=this,r="";;){var i=Da(n,t).g,s=((0<(n=Aa(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Sa(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},Sr.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Sr.X=function(e){return Ca(e=Aa(this,e))?-1:Sa(e)?0:1},Sr.abs=function(){return Ca(this)?ka(this):this},Sr.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new ya(n,-2147483648&n[n.length-1]?-1:0)},Sr.R=function(e){if(Sa(this)||Sa(e))return ba;if(Ca(this))return Ca(e)?ka(this).R(ka(e)):ka(ka(this).R(e));if(Ca(e))return ka(this.R(ka(e)));if(0>this.X(Ta)&&0>e.X(Ta))return _a(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=e.D(i)>>>16,c=65535&e.D(i);n[2*r+2*i]+=o*c,Na(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Na(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Na(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Na(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new ya(n,0)},Sr.gb=function(e){return Da(this,e).h},Sr.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new ya(n,this.h&e.h)},Sr.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new ya(n,this.h|e.h)},Sr.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new ya(n,this.h^e.h)},la.prototype.createWebChannel=la.prototype.g,ha.prototype.send=ha.prototype.u,ha.prototype.open=ha.prototype.m,ha.prototype.close=ha.prototype.close,ps.NO_ERROR=0,ps.TIMEOUT=8,ps.HTTP_ERROR=6,gs.COMPLETE="complete",vs.EventType=_s,_s.OPEN="a",_s.CLOSE="b",_s.ERROR="c",_s.MESSAGE="d",Li.prototype.listen=Li.prototype.O,Ro.prototype.listenOnce=Ro.prototype.P,Ro.prototype.getLastError=Ro.prototype.Sa,Ro.prototype.getLastErrorCode=Ro.prototype.Ia,Ro.prototype.getStatus=Ro.prototype.da,Ro.prototype.getResponseJson=Ro.prototype.Wa,Ro.prototype.getResponseText=Ro.prototype.ja,Ro.prototype.send=Ro.prototype.ha,Ro.prototype.setWithCredentials=Ro.prototype.Oa,ga.prototype.digest=ga.prototype.l,ga.prototype.reset=ga.prototype.reset,ga.prototype.update=ga.prototype.j,ya.prototype.add=ya.prototype.add,ya.prototype.multiply=ya.prototype.R,ya.prototype.modulo=ya.prototype.gb,ya.prototype.compare=ya.prototype.X,ya.prototype.toNumber=ya.prototype.ea,ya.prototype.toString=ya.prototype.toString,ya.prototype.getBits=ya.prototype.D,ya.fromNumber=_a,ya.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return ka(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=_a(Math.pow(n,8)),i=ba,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=_a(Math.pow(n,o)),i=i.R(o).add(_a(a))):i=(i=i.R(r)).add(_a(a))}return i};var La=kr.createWebChannelTransport=function(){return new la},Ma=kr.getStatEventTarget=function(){return as()},xa=kr.ErrorCode=ps,Ua=kr.EventType=gs,Fa=kr.Event=ss,Va=kr.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ja=(kr.FetchXmlHttpFactory=Io,kr.WebChannel=vs),Ba=kr.XhrIo=Ro,$a=kr.Md5=ga,qa=kr.Integer=ya;const za="@firebase/firestore";class Ka{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ka.UNAUTHENTICATED=new Ka(null),Ka.GOOGLE_CREDENTIALS=new Ka("google-credentials-uid"),Ka.FIRST_PARTY=new Ka("first-party-uid"),Ka.MOCK_USER=new Ka("mock-user");let Ha="10.5.0";const Ga=new z("@firebase/firestore");function Wa(){return Ga.logLevel}function Qa(e,...t){if(Ga.logLevel<=F.DEBUG){const n=t.map(Ya);Ga.debug(`Firestore (${Ha}): ${e}`,...n)}}function Ja(e,...t){if(Ga.logLevel<=F.ERROR){const n=t.map(Ya);Ga.error(`Firestore (${Ha}): ${e}`,...n)}}function Xa(e,...t){if(Ga.logLevel<=F.WARN){const n=t.map(Ya);Ga.warn(`Firestore (${Ha}): ${e}`,...n)}}function Ya(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Za(e="Unexpected state"){const t=`FIRESTORE (${Ha}) INTERNAL ASSERTION FAILED: `+e;throw Ja(t),new Error(t)}function ec(e,t){e||Za()}function tc(e,t){return e}const nc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rc extends y{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ic{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class sc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class oc{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ka.UNAUTHENTICATED)))}shutdown(){}}class ac{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class cc{constructor(e){this.t=e,this.currentUser=Ka.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new ic;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ic,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Qa("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Qa("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ic)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Qa("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ec("string"==typeof t.accessToken),new sc(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ec(null===e||"string"==typeof e),new Ka(e)}}class uc{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ka.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class lc{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new uc(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ka.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class hc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class dc{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&Qa("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Qa("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Qa("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Qa("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ec("string"==typeof e.token),this.R=e.token,new hc(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function fc(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class pc{static V(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=fc(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function gc(e,t){return e<t?-1:e>t?1:0}function mc(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class yc{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new rc(nc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new rc(nc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new rc(nc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new rc(nc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return yc.fromMillis(Date.now())}static fromDate(e){return yc.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new yc(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?gc(this.nanoseconds,e.nanoseconds):gc(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class vc{constructor(e){this.timestamp=e}static fromTimestamp(e){return new vc(e)}static min(){return new vc(new yc(0,0))}static max(){return new vc(new yc(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class wc{constructor(e,t,n){void 0===t?t=0:t>e.length&&Za(),void 0===n?n=e.length-t:n>e.length-t&&Za(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===wc.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof wc?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class _c extends wc{construct(e,t,n){return new _c(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new rc(nc.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new _c(t)}static emptyPath(){return new _c([])}}const Ec=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bc extends wc{construct(e,t,n){return new bc(e,t,n)}static isValidIdentifier(e){return Ec.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bc.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new bc(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new rc(nc.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new rc(nc.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new rc(nc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new rc(nc.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bc(t)}static emptyPath(){return new bc([])}}class Ic{constructor(e){this.path=e}static fromPath(e){return new Ic(_c.fromString(e))}static fromName(e){return new Ic(_c.fromString(e).popFirst(5))}static empty(){return new Ic(_c.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===_c.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return _c.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ic(new _c(e.slice()))}}function Tc(e){return new Sc(e.readTime,e.key,-1)}class Sc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Sc(vc.min(),Ic.empty(),-1)}static max(){return new Sc(vc.max(),Ic.empty(),-1)}}function Cc(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Ic.comparator(e.documentKey,t.documentKey),0!==n?n:gc(e.largestBatchId,t.largestBatchId))}const kc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ac{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Nc(e){if(e.code!==nc.FAILED_PRECONDITION||e.message!==kc)throw e;Qa("LocalStore","Unexpectedly lost primary lease")}class Rc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Za(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Rc(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Rc?t:Rc.resolve(t)}catch(e){return Rc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Rc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Rc.reject(t)}static resolve(e){return new Rc(((t,n)=>{t(e)}))}static reject(e){return new Rc(((t,n)=>{n(e)}))}static waitFor(e){return new Rc(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Rc.resolve(!1);for(const n of e)t=t.next((e=>e?Rc.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Rc(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Rc(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function Dc(e){return"IndexedDbTransactionError"===e.name}class Pc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}function Oc(e){return null==e}function Lc(e){return 0===e&&1/e==-1/0}Pc.ae=-1;function Mc(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function xc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Uc(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Fc{constructor(e,t){this.comparator=e,this.root=t||jc.EMPTY}insert(e,t){return new Fc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,jc.BLACK,null,null))}remove(e){return new Fc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,jc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vc(this.root,e,this.comparator,!0)}}class Vc{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class jc{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:jc.RED,this.left=null!=r?r:jc.EMPTY,this.right=null!=i?i:jc.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new jc(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return jc.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return jc.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,jc.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,jc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Za();if(this.right.isRed())throw Za();const e=this.left.check();if(e!==this.right.check())throw Za();return e+(this.isRed()?0:1)}}jc.EMPTY=null,jc.RED=!0,jc.BLACK=!1,jc.EMPTY=new class{constructor(){this.size=0}get key(){throw Za()}get value(){throw Za()}get color(){throw Za()}get left(){throw Za()}get right(){throw Za()}copy(e,t,n,r,i){return this}insert(e,t,n){return new jc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Bc{constructor(e){this.comparator=e,this.data=new Fc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $c(this.data.getIterator())}getIteratorFrom(e){return new $c(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Bc))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Bc(this.comparator);return t.data=e,t}}class $c{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qc{constructor(e){this.fields=e,e.sort(bc.comparator)}static empty(){return new qc([])}unionWith(e){let t=new Bc(bc.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new qc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mc(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class zc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Kc{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new zc("Invalid base64 string: "+e):e}}(e);return new Kc(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Kc(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return gc(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Kc.EMPTY_BYTE_STRING=new Kc("");const Hc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gc(e){if(ec(!!e),"string"==typeof e){let t=0;const n=Hc.exec(e);if(ec(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Wc(e.seconds),nanos:Wc(e.nanos)}}function Wc(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Qc(e){return"string"==typeof e?Kc.fromBase64String(e):Kc.fromUint8Array(e)}function Jc(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Xc(e){const t=e.mapValue.fields.__previous_value__;return Jc(t)?Xc(t):t}function Yc(e){const t=Gc(e.mapValue.fields.__local_write_time__.timestampValue);return new yc(t.seconds,t.nanos)}class Zc{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class eu{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new eu("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof eu&&e.projectId===this.projectId&&e.database===this.database}}const tu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function nu(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Jc(e)?4:mu(e)?9007199254740991:10:Za()}function ru(e,t){if(e===t)return!0;const n=nu(e);if(n!==nu(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Yc(e).isEqual(Yc(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Gc(e.timestampValue),r=Gc(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Qc(e.bytesValue).isEqual(Qc(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Wc(e.geoPointValue.latitude)===Wc(t.geoPointValue.latitude)&&Wc(e.geoPointValue.longitude)===Wc(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Wc(e.integerValue)===Wc(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Wc(e.doubleValue),r=Wc(t.doubleValue);return n===r?Lc(n)===Lc(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return mc(e.arrayValue.values||[],t.arrayValue.values||[],ru);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Mc(n)!==Mc(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ru(n[e],r[e])))return!1;return!0}(e,t);default:return Za()}}function iu(e,t){return void 0!==(e.values||[]).find((e=>ru(e,t)))}function su(e,t){if(e===t)return 0;const n=nu(e),r=nu(t);if(n!==r)return gc(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return gc(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Wc(e.integerValue||e.doubleValue),r=Wc(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ou(e.timestampValue,t.timestampValue);case 4:return ou(Yc(e),Yc(t));case 5:return gc(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Qc(e),r=Qc(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=gc(n[e],r[e]);if(0!==t)return t}return gc(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=gc(Wc(e.latitude),Wc(t.latitude));return 0!==n?n:gc(Wc(e.longitude),Wc(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=su(n[e],r[e]);if(t)return t}return gc(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===tu.mapValue&&t===tu.mapValue)return 0;if(e===tu.mapValue)return 1;if(t===tu.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=gc(r[e],s[e]);if(0!==t)return t;const o=su(n[r[e]],i[s[e]]);if(0!==o)return o}return gc(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Za()}}function ou(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return gc(e,t);const n=Gc(e),r=Gc(t),i=gc(n.seconds,r.seconds);return 0!==i?i:gc(n.nanos,r.nanos)}function au(e){return cu(e)}function cu(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Gc(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Qc(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Ic.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=cu(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${cu(e.fields[i])}`;return n+"}"}(e.mapValue):Za()}function uu(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function lu(e){return!!e&&"integerValue"in e}function hu(e){return!!e&&"arrayValue"in e}function du(e){return!!e&&"nullValue"in e}function fu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function pu(e){return!!e&&"mapValue"in e}function gu(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return xc(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=gu(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=gu(e.arrayValue.values[n]);return t}return Object.assign({},e)}function mu(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class yu{constructor(e){this.value=e}static empty(){return new yu({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!pu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gu(t)}setAll(e){let t=bc.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=gu(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());pu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ru(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];pu(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){xc(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new yu(gu(this.value))}}function vu(e){const t=[];return xc(e.fields,((e,n)=>{const r=new bc([e]);if(pu(n)){const e=vu(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new qc(t)}class wu{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new wu(e,0,vc.min(),vc.min(),vc.min(),yu.empty(),0)}static newFoundDocument(e,t,n,r){return new wu(e,1,t,vc.min(),n,r,0)}static newNoDocument(e,t){return new wu(e,2,t,vc.min(),vc.min(),yu.empty(),0)}static newUnknownDocument(e,t){return new wu(e,3,t,vc.min(),vc.min(),yu.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(vc.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yu.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yu.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=vc.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof wu&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wu(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class _u{constructor(e,t){this.position=e,this.inclusive=t}}function Eu(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?Ic.comparator(Ic.fromName(o.referenceValue),n.key):su(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function bu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ru(e.position[n],t.position[n]))return!1;return!0}class Iu{constructor(e,t="asc"){this.field=e,this.dir=t}}function Tu(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Su{}class Cu extends Su{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ou(e,t,n):"array-contains"===t?new Uu(e,n):"in"===t?new Fu(e,n):"not-in"===t?new Vu(e,n):"array-contains-any"===t?new ju(e,n):new Cu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Lu(e,n):new Mu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(su(t,this.value)):null!==t&&nu(this.value)===nu(t)&&this.matchesComparison(su(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Za()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ku extends Su{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new ku(e,t)}matches(e){return Au(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Au(e){return"and"===e.op}function Nu(e){return function(e){for(const t of e.filters)if(t instanceof ku)return!1;return!0}(e)&&Au(e)}function Ru(e){if(e instanceof Cu)return e.field.canonicalString()+e.op.toString()+au(e.value);if(Nu(e))return e.filters.map((e=>Ru(e))).join(",");{const t=e.filters.map((e=>Ru(e))).join(",");return`${e.op}(${t})`}}function Du(e,t){return e instanceof Cu?function(e,t){return t instanceof Cu&&e.op===t.op&&e.field.isEqual(t.field)&&ru(e.value,t.value)}(e,t):e instanceof ku?function(e,t){return t instanceof ku&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Du(n,t.filters[r])),!0)}(e,t):void Za()}function Pu(e){return e instanceof Cu?function(e){return`${e.field.canonicalString()} ${e.op} ${au(e.value)}`}(e):e instanceof ku?function(e){return e.op.toString()+" {"+e.getFilters().map(Pu).join(" ,")+"}"}(e):"Filter"}class Ou extends Cu{constructor(e,t,n){super(e,t,n),this.key=Ic.fromName(n.referenceValue)}matches(e){const t=Ic.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lu extends Cu{constructor(e,t){super(e,"in",t),this.keys=xu(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Mu extends Cu{constructor(e,t){super(e,"not-in",t),this.keys=xu(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function xu(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Ic.fromName(e.referenceValue)))}class Uu extends Cu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hu(t)&&iu(t.arrayValue,this.value)}}class Fu extends Cu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&iu(this.value.arrayValue,t)}}class Vu extends Cu{constructor(e,t){super(e,"not-in",t)}matches(e){if(iu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!iu(this.value.arrayValue,t)}}class ju extends Cu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hu(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>iu(this.value.arrayValue,e)))}}class Bu{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.le=null}}function $u(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Bu(e,t,n,r,i,s,o)}function qu(e){const t=tc(e);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Ru(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Oc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>au(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>au(e))).join(",")),t.le=e}return t.le}function zu(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Tu(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Du(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!bu(e.startAt,t.startAt)&&bu(e.endAt,t.endAt)}function Ku(e){return Ic.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Hu{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.he=null,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function Gu(e){return new Hu(e)}function Wu(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Qu(e){return null!==e.collectionGroup}function Ju(e){const t=tc(e);if(null===t.he){t.he=[];const e=new Set;for(const n of t.explicitOrderBy)t.he.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Bc(bc.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.he.push(new Iu(r,n))})),e.has(bc.keyField().canonicalString())||t.he.push(new Iu(bc.keyField(),n))}return t.he}function Xu(e){const t=tc(e);return t.Pe||(t.Pe=function(e,t){if("F"===e.limitType)return $u(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Iu(e.field,t)}));const n=e.endAt?new _u(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new _u(e.startAt.position,e.startAt.inclusive):null;return $u(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,Ju(e))),t.Pe}function Yu(e,t){const n=e.filters.concat([t]);return new Hu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Zu(e,t,n){return new Hu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function el(e,t){return zu(Xu(e),Xu(t))&&e.limitType===t.limitType}function tl(e){return`${qu(Xu(e))}|lt:${e.limitType}`}function nl(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Pu(e))).join(", ")}]`),Oc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>au(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>au(e))).join(",")),`Target(${t})`}(Xu(e))}; limitType=${e.limitType})`}function rl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ic.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Ju(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Eu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Ju(e),t)||e.endAt&&!function(e,t,n){const r=Eu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Ju(e),t))}(e,t)}function il(e){return(t,n)=>{let r=!1;for(const i of Ju(e)){const e=sl(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function sl(e,t,n){const r=e.field.isKeyField()?Ic.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?su(r,i):Za()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Za()}}class ol{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){xc(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Uc(this.inner)}size(){return this.innerSize}}const al=new Fc(Ic.comparator);function cl(){return al}const ul=new Fc(Ic.comparator);function ll(...e){let t=ul;for(const n of e)t=t.insert(n.key,n);return t}function hl(e){let t=ul;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function dl(){return pl()}function fl(){return pl()}function pl(){return new ol((e=>e.toString()),((e,t)=>e.isEqual(t)))}const gl=new Fc(Ic.comparator),ml=new Bc(Ic.comparator);function yl(...e){let t=ml;for(const n of e)t=t.add(n);return t}const vl=new Bc(gc);function wl(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lc(t)?"-0":t}}function _l(e){return{integerValue:""+e}}function El(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Lc(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?_l(t):wl(e,t)}class bl{constructor(){this._=void 0}}function Il(e,t,n){return e instanceof Cl?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Jc(t)&&(t=Xc(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof kl?Al(e,t):e instanceof Nl?Rl(e,t):function(e,t){const n=Sl(e,t),r=Pl(n)+Pl(e.Te);return lu(n)&&lu(e.Te)?_l(r):wl(e.serializer,r)}(e,t)}function Tl(e,t,n){return e instanceof kl?Al(e,t):e instanceof Nl?Rl(e,t):n}function Sl(e,t){return e instanceof Dl?function(e){return lu(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Cl extends bl{}class kl extends bl{constructor(e){super(),this.elements=e}}function Al(e,t){const n=Ol(t);for(const t of e.elements)n.some((e=>ru(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Nl extends bl{constructor(e){super(),this.elements=e}}function Rl(e,t){let n=Ol(t);for(const t of e.elements)n=n.filter((e=>!ru(e,t)));return{arrayValue:{values:n}}}class Dl extends bl{constructor(e,t){super(),this.serializer=e,this.Te=t}}function Pl(e){return Wc(e.integerValue||e.doubleValue)}function Ol(e){return hu(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ll{constructor(e,t){this.version=e,this.transformResults=t}}class Ml{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ml}static exists(e){return new Ml(void 0,e)}static updateTime(e){return new Ml(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xl(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ul{}function Fl(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Wl(e.key,Ml.none()):new ql(e.key,e.data,Ml.none());{const n=e.data,r=yu.empty();let i=new Bc(bc.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new zl(e.key,r,new qc(i.toArray()),Ml.none())}}function Vl(e,t,n){e instanceof ql?function(e,t,n){const r=e.value.clone(),i=Hl(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof zl?function(e,t,n){if(!xl(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Hl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Kl(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function jl(e,t,n,r){return e instanceof ql?function(e,t,n,r){if(!xl(e.precondition,t))return n;const i=e.value.clone(),s=Gl(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof zl?function(e,t,n,r){if(!xl(e.precondition,t))return n;const i=Gl(e.fieldTransforms,r,t),s=t.data;return s.setAll(Kl(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return xl(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Bl(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Sl(r.transform,e||null);null!=i&&(null===n&&(n=yu.empty()),n.set(r.field,i))}return n||null}function $l(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&mc(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof kl&&t instanceof kl||e instanceof Nl&&t instanceof Nl?mc(e.elements,t.elements,ru):e instanceof Dl&&t instanceof Dl?ru(e.Te,t.Te):e instanceof Cl&&t instanceof Cl}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ql extends Ul{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class zl extends Ul{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Kl(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Hl(e,t,n){const r=new Map;ec(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Tl(o,a,n[i]))}return r}function Gl(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Il(e,s,t))}return r}class Wl extends Ul{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ql extends Ul{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Jl{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Vl(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=jl(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=jl(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=fl();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Fl(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(vc.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),yl())}isEqual(e){return this.batchId===e.batchId&&mc(this.mutations,e.mutations,((e,t)=>$l(e,t)))&&mc(this.baseMutations,e.baseMutations,((e,t)=>$l(e,t)))}}class Xl{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ec(e.mutations.length===n.length);let r=gl;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Xl(e,t,n,r)}}class Yl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Zl{constructor(e,t){this.count=e,this.unchangedNames=t}}var eh,th;function nh(e){if(void 0===e)return Ja("GRPC error has no .code"),nc.UNKNOWN;switch(e){case eh.OK:return nc.OK;case eh.CANCELLED:return nc.CANCELLED;case eh.UNKNOWN:return nc.UNKNOWN;case eh.DEADLINE_EXCEEDED:return nc.DEADLINE_EXCEEDED;case eh.RESOURCE_EXHAUSTED:return nc.RESOURCE_EXHAUSTED;case eh.INTERNAL:return nc.INTERNAL;case eh.UNAVAILABLE:return nc.UNAVAILABLE;case eh.UNAUTHENTICATED:return nc.UNAUTHENTICATED;case eh.INVALID_ARGUMENT:return nc.INVALID_ARGUMENT;case eh.NOT_FOUND:return nc.NOT_FOUND;case eh.ALREADY_EXISTS:return nc.ALREADY_EXISTS;case eh.PERMISSION_DENIED:return nc.PERMISSION_DENIED;case eh.FAILED_PRECONDITION:return nc.FAILED_PRECONDITION;case eh.ABORTED:return nc.ABORTED;case eh.OUT_OF_RANGE:return nc.OUT_OF_RANGE;case eh.UNIMPLEMENTED:return nc.UNIMPLEMENTED;case eh.DATA_LOSS:return nc.DATA_LOSS;default:return Za()}}(th=eh||(eh={}))[th.OK=0]="OK",th[th.CANCELLED=1]="CANCELLED",th[th.UNKNOWN=2]="UNKNOWN",th[th.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",th[th.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",th[th.NOT_FOUND=5]="NOT_FOUND",th[th.ALREADY_EXISTS=6]="ALREADY_EXISTS",th[th.PERMISSION_DENIED=7]="PERMISSION_DENIED",th[th.UNAUTHENTICATED=16]="UNAUTHENTICATED",th[th.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",th[th.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",th[th.ABORTED=10]="ABORTED",th[th.OUT_OF_RANGE=11]="OUT_OF_RANGE",th[th.UNIMPLEMENTED=12]="UNIMPLEMENTED",th[th.INTERNAL=13]="INTERNAL",th[th.UNAVAILABLE=14]="UNAVAILABLE",th[th.DATA_LOSS=15]="DATA_LOSS";const rh=new qa([4294967295,4294967295],0);function ih(e){const t=(new TextEncoder).encode(e),n=new $a;return n.update(t),new Uint8Array(n.digest())}function sh(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new qa([n,r],0),new qa([i,s],0)]}class oh{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ah(`Invalid padding: ${t}`);if(n<0)throw new ah(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new ah(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new ah(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=qa.fromNumber(this.Ee)}Ae(e,t,n){let r=e.add(t.multiply(qa.fromNumber(n)));return 1===r.compare(rh)&&(r=new qa([r.getBits(0),r.getBits(1)],0)),r.modulo(this.de).toNumber()}Re(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;const t=ih(e),[n,r]=sh(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);if(!this.Re(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new oh(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ee)return;const t=ih(e),[n,r]=sh(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);this.Ve(t)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ah extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ch{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,uh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ch(vc.min(),r,new Fc(gc),cl(),yl())}}class uh{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new uh(n,t,yl(),yl(),yl())}}class lh{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class hh{constructor(e,t){this.targetId=e,this.ge=t}}class dh{constructor(e,t,n=Kc.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class fh{constructor(){this.pe=0,this.ye=mh(),this.we=Kc.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return 0!==this.pe}get Ce(){return this.be}ve(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=yl(),t=yl(),n=yl();return this.ye.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Za()}})),new uh(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=mh()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1}Le(){this.be=!0,this.Se=!0}}class ph{constructor(e){this.ke=e,this.qe=new Map,this.Qe=cl(),this.Ke=gh(),this.$e=new Fc(gc)}Ue(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.We(t,e.fe):this.Ge(t,e.key,e.fe);for(const t of e.removedTargetIds)this.Ge(t,e.key,e.fe)}ze(e){this.forEachTarget(e,(t=>{const n=this.je(t);switch(e.state){case 0:this.He(t)&&n.ve(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.ve(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.He(t)&&(n.Le(),n.ve(e.resumeToken));break;case 4:this.He(t)&&(this.Je(t),n.ve(e.resumeToken));break;default:Za()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach(((e,n)=>{this.He(n)&&t(n)}))}Ye(e){const t=e.targetId,n=e.ge.count,r=this.Ze(t);if(r){const i=r.target;if(Ku(i))if(0===n){const e=new Ic(i.path);this.Ge(t,e,wu.newNoDocument(e,vc.min()))}else ec(1===n);else{const r=this.Xe(t);if(r!==n){const n=this.et(e),i=n?this.tt(n,e,r):1;if(0!==i){this.Je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.$e=this.$e.insert(t,e)}}}}}et(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Qc(n).toUint8Array()}catch(e){if(e instanceof zc)return Xa("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new oh(s,r,i)}catch(e){return Xa(e instanceof ah?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ee?null:o}tt(e,t,n){return t.ge.count===n-this.it(e,t.targetId)?0:2}it(e,t){const n=this.ke.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.ke.rt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.Ge(t,n,null),r++)})),r}st(e){const t=new Map;this.qe.forEach(((n,r)=>{const i=this.Ze(r);if(i){if(n.current&&Ku(i.target)){const t=new Ic(i.target.path);null!==this.Qe.get(t)||this.ot(r,t)||this.Ge(r,t,wu.newNoDocument(t,e))}n.Ce&&(t.set(r,n.Fe()),n.Me())}}));let n=yl();this.Ke.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ze(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Qe.forEach(((t,n)=>n.setReadTime(e)));const r=new ch(e,t,this.$e,this.Qe,n);return this.Qe=cl(),this.Ke=gh(),this.$e=new Fc(gc),r}We(e,t){if(!this.He(e))return;const n=this.ot(e,t.key)?2:0;this.je(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.Ke=this.Ke.insert(t.key,this._t(t.key).add(e))}Ge(e,t,n){if(!this.He(e))return;const r=this.je(e);this.ot(e,t)?r.xe(t,1):r.Oe(t),this.Ke=this.Ke.insert(t,this._t(t).delete(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}Xe(e){const t=this.je(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.je(e).Ne()}je(e){let t=this.qe.get(e);return t||(t=new fh,this.qe.set(e,t)),t}_t(e){let t=this.Ke.get(e);return t||(t=new Bc(gc),this.Ke=this.Ke.insert(e,t)),t}He(e){const t=null!==this.Ze(e);return t||Qa("WatchChangeAggregator","Detected inactive target",e),t}Ze(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.ut(e)}Je(e){this.qe.set(e,new fh),this.ke.getRemoteKeysForTarget(e).forEach((t=>{this.Ge(e,t,null)}))}ot(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function gh(){return new Fc(Ic.comparator)}function mh(){return new Fc(Ic.comparator)}const yh={asc:"ASCENDING",desc:"DESCENDING"},vh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},wh={and:"AND",or:"OR"};class _h{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Eh(e,t){return e.useProto3Json||Oc(t)?t:{value:t}}function bh(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ih(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Th(e,t){return bh(e,t.toTimestamp())}function Sh(e){return ec(!!e),vc.fromTimestamp(function(e){const t=Gc(e);return new yc(t.seconds,t.nanos)}(e))}function Ch(e,t){return function(e){return new _c(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function kh(e){const t=_c.fromString(e);return ec(Kh(t)),t}function Ah(e,t){return Ch(e.databaseId,t.path)}function Nh(e,t){const n=kh(t);if(n.get(1)!==e.databaseId.projectId)throw new rc(nc.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new rc(nc.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ic(Ph(n))}function Rh(e,t){return Ch(e.databaseId,t)}function Dh(e){return new _c(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ph(e){return ec(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oh(e,t,n){return{name:Ah(e,t),fields:n.value.mapValue.fields}}function Lh(e,t){return{documents:[Rh(e,t.path)]}}function Mh(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Rh(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Rh(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0!==e.length)return qh(ku.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Bh(e.field),direction:Fh(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=Eh(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function xh(e){let t=function(e){const t=kh(e);return 4===t.length?_c.emptyPath():Ph(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ec(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Uh(e);return t instanceof ku&&Nu(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Iu($h(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Oc(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new _u(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new _u(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new Hu(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function Uh(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=$h(e.unaryFilter.field);return Cu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=$h(e.unaryFilter.field);return Cu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=$h(e.unaryFilter.field);return Cu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=$h(e.unaryFilter.field);return Cu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Za()}}(e):void 0!==e.fieldFilter?function(e){return Cu.create($h(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Za()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ku.create(e.compositeFilter.filters.map((e=>Uh(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Za()}}(e.compositeFilter.op))}(e):Za()}function Fh(e){return yh[e]}function Vh(e){return vh[e]}function jh(e){return wh[e]}function Bh(e){return{fieldPath:e.canonicalString()}}function $h(e){return bc.fromServerFormat(e.fieldPath)}function qh(e){return e instanceof Cu?function(e){if("=="===e.op){if(fu(e.value))return{unaryFilter:{field:Bh(e.field),op:"IS_NAN"}};if(du(e.value))return{unaryFilter:{field:Bh(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(fu(e.value))return{unaryFilter:{field:Bh(e.field),op:"IS_NOT_NAN"}};if(du(e.value))return{unaryFilter:{field:Bh(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bh(e.field),op:Vh(e.op),value:e.value}}}(e):e instanceof ku?function(e){const t=e.getFilters().map((e=>qh(e)));return 1===t.length?t[0]:{compositeFilter:{op:jh(e.op),filters:t}}}(e):Za()}function zh(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Kh(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Hh{constructor(e,t,n,r,i=vc.min(),s=vc.min(),o=Kc.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Hh(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Hh(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Hh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Hh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Gh{constructor(e){this.ct=e}}function Wh(e){const t=xh({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Zu(t,t.limit,"L"):t}class Qh{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(Wc(e.integerValue));else if("doubleValue"in e){const n=Wc(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Lc(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Qc(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?mu(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):Za()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),Ic.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}Qh.bt=new Qh;class Jh{constructor(){this._n=new Xh}addToCollectionParentIndex(e,t){return this._n.add(t),Rc.resolve()}getCollectionParents(e,t){return Rc.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Rc.resolve()}deleteFieldIndex(e,t){return Rc.resolve()}deleteAllFieldIndexes(e){return Rc.resolve()}createTargetIndexes(e,t){return Rc.resolve()}getDocumentsMatchingTarget(e,t){return Rc.resolve(null)}getIndexType(e,t){return Rc.resolve(0)}getFieldIndexes(e,t){return Rc.resolve([])}getNextCollectionGroupToUpdate(e){return Rc.resolve(null)}getMinOffset(e,t){return Rc.resolve(Sc.min())}getMinOffsetFromCollectionGroup(e,t){return Rc.resolve(Sc.min())}updateCollectionGroup(e,t,n){return Rc.resolve()}updateIndexEntries(e,t){return Rc.resolve()}}class Xh{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Bc(_c.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Bc(_c.comparator)).toArray()}}new Uint8Array(0);class Yh{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Yh(e,Yh.DEFAULT_COLLECTION_PERCENTILE,Yh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Yh.DEFAULT_COLLECTION_PERCENTILE=10,Yh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yh.DEFAULT=new Yh(41943040,Yh.DEFAULT_COLLECTION_PERCENTILE,Yh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yh.DISABLED=new Yh(-1,0,0);class Zh{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new Zh(0)}static Bn(){return new Zh(-1)}}class ed{constructor(){this.changes=new ol((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,wu.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Rc.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class td{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class nd{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&jl(n.mutation,e,qc.empty(),yc.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,yl()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=yl()){const r=dl();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ll();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=dl();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,yl())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=cl();const s=pl(),o=pl();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof zl)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),jl(o.mutation,t,o.mutation.getFieldMask(),yc.now())):s.set(t.key,qc.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new td(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=pl();let r=new Fc(((e,t)=>e-t)),i=yl();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||qc.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||yl()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=fl();c.forEach((e=>{if(!i.has(e)){const r=Fl(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Rc.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Ic.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Qu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Rc.resolve(dl());let o=-1,a=i;return s.next((t=>Rc.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?Rc.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,yl()))).next((e=>({batchId:o,changes:hl(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ic(t)).next((e=>{let t=ll();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=ll();return this.indexManager.getCollectionParents(e,i).next((o=>Rc.forEach(o,(o=>{const a=function(e,t){return new Hu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,wu.newInvalidDocument(r)))}));let n=ll();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&jl(s.mutation,r,qc.empty(),yc.now()),rl(t,r)&&(n=n.insert(e,r))})),n}))}}class rd{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Rc.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Sh(e.createTime)}}(t)),Rc.resolve()}getNamedQuery(e,t){return Rc.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:Wh(e.bundledQuery),readTime:Sh(e.readTime)}}(t)),Rc.resolve()}}class id{constructor(){this.overlays=new Fc(Ic.comparator),this.hr=new Map}getOverlay(e,t){return Rc.resolve(this.overlays.get(t))}getOverlays(e,t){const n=dl();return Rc.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Rc.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Rc.resolve()}getOverlaysForCollection(e,t,n){const r=dl(),i=t.length+1,s=new Ic(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Rc.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Fc(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=dl(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=dl(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Rc.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Yl(t,n));let i=this.hr.get(t);void 0===i&&(i=yl(),this.hr.set(t,i)),this.hr.set(t,i.add(n.key))}}class sd{constructor(){this.Pr=new Bc(od.Ir),this.Tr=new Bc(od.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new od(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new od(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Ic(new _c([])),n=new od(t,e),r=new od(t,e+1),i=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),i.push(e.key)})),i}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Ic(new _c([])),n=new od(t,e),r=new od(t,e+1);let i=yl();return this.Tr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new od(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class od{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Ic.comparator(e.key,t.key)||gc(e.pr,t.pr)}static Er(e,t){return gc(e.pr,t.pr)||Ic.comparator(e.key,t.key)}}class ad{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Bc(od.Ir)}checkEmpty(e){return Rc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Jl(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.wr=this.wr.add(new od(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Rc.resolve(s)}lookupMutationBatch(e,t){return Rc.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),i=r<0?0:r;return Rc.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Rc.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Rc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new od(t,0),r=new od(t,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);i.push(t)})),Rc.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Bc(gc);return t.forEach((e=>{const t=new od(e,0),r=new od(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Rc.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;Ic.isDocumentKey(i)||(i=i.child(""));const s=new od(new Ic(i),0);let o=new Bc(gc);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),s),Rc.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ec(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Rc.forEach(t.mutations,(r=>{const i=new od(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new od(t,0),r=this.wr.firstAfterOrEqual(n);return Rc.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Rc.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class cd{constructor(e){this.vr=e,this.docs=new Fc(Ic.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Rc.resolve(n?n.document.mutableCopy():wu.newInvalidDocument(t))}getEntries(e,t){let n=cl();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():wu.newInvalidDocument(e))})),Rc.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=cl();const s=t.path,o=new Ic(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Cc(Tc(o),n)<=0||(r.has(o.key)||rl(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Rc.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Za()}Fr(e,t){return Rc.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new ud(this)}getSize(e){return Rc.resolve(this.size)}}class ud extends ed{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Rc.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class ld{constructor(e){this.persistence=e,this.Mr=new ol((e=>qu(e)),zu),this.lastRemoteSnapshotVersion=vc.min(),this.highestTargetId=0,this.Or=0,this.Nr=new sd,this.targetCount=0,this.Br=Zh.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Rc.resolve()}getLastRemoteSnapshotVersion(e){return Rc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Rc.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Br.next(),Rc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Rc.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Br=new Zh(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Rc.resolve()}updateTargetData(e,t){return this.qn(t),Rc.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Rc.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Rc.waitFor(i).next((()=>r))}getTargetCount(e){return Rc.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Rc.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Rc.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Rc.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Rc.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Rc.resolve(n)}containsKey(e,t){return Rc.resolve(this.Nr.containsKey(t))}}class hd{constructor(e,t){this.Lr={},this.overlays={},this.kr=new Pc(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new ld(this),this.indexManager=new Jh,this.remoteDocumentCache=function(e){return new cd(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new Gh(t),this.$r=new rd(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new id,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Lr[e.toKey()];return n||(n=new ad(t,this.referenceDelegate),this.Lr[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){Qa("MemoryPersistence","Starting transaction:",e);const r=new dd(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Rc.or(Object.values(this.Lr).map((n=>()=>n.containsKey(e,t))))}}class dd extends Ac{constructor(e){super(),this.currentSequenceNumber=e}}class fd{constructor(e){this.persistence=e,this.zr=new sd,this.jr=null}static Hr(e){return new fd(e)}get Jr(){if(this.jr)return this.jr;throw Za()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Rc.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Rc.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Rc.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Rc.forEach(this.Jr,(n=>{const r=Ic.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,vc.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Rc.or([()=>Rc.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class pd{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=yl(),r=yl();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new pd(e,t.fromCache,n,r)}}class gd{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class md{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=8}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.ji(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Hi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new gd;return this.Ji(e,t,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>i.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Wa()<=F.DEBUG&&Qa("QueryEngine","SDK will not create cache indexes for query:",nl(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Rc.resolve()):(Wa()<=F.DEBUG&&Qa("QueryEngine","Query:",nl(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Wa()<=F.DEBUG&&Qa("QueryEngine","The SDK decides to create cache indexes for query:",nl(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Xu(t))):Rc.resolve())}ji(e,t){if(Wu(t))return Rc.resolve(null);let n=Xu(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Zu(t,null,"F"),n=Xu(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=yl(...r);return this.zi.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.Zi(t,r);return this.Xi(t,s,i,n.readTime)?this.ji(e,Zu(t,null,"F")):this.es(e,s,t,n)}))))})))))}Hi(e,t,n,r){return Wu(t)||r.isEqual(vc.min())?Rc.resolve(null):this.zi.getDocuments(e,n).next((i=>{const s=this.Zi(t,i);return this.Xi(t,s,n,r)?Rc.resolve(null):(Wa()<=F.DEBUG&&Qa("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),nl(t)),this.es(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=vc.fromTimestamp(1e9===r?new yc(n+1,0):new yc(n,r));return new Sc(i,Ic.empty(),t)}(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Bc(il(e));return t.forEach(((t,r)=>{rl(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(e,t,n){return Wa()<=F.DEBUG&&Qa("QueryEngine","Using full collection scan to execute query:",nl(t)),this.zi.getDocumentsMatchingQuery(e,t,Sc.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class yd{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Fc(gc),this.rs=new ol((e=>qu(e)),zu),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new nd(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}async function vd(e,t){const n=tc(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=yl();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function wd(e){const t=tc(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function _d(e,t){const n=tc(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Ed(e,t,n){const r=tc(e),i=r.ns.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Dc(e))throw e;Qa("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(i.target)}function bd(e,t,n){const r=tc(e);let i=vc.min(),s=yl();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=tc(e),i=r.rs.get(n);return void 0!==i?Rc.resolve(r.ns.get(i)):r.Qr.getTargetData(t,n)}(r,e,Xu(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?i:vc.min(),n?s:yl()))).next((e=>(function(e,t,n){let r=e.ss.get(t)||vc.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,hs:s})))))}class Id{constructor(){this.activeTargetIds=vl}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Td{constructor(){this.no=new Id,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Id,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Sd{io(e){}shutdown(){}}class Cd{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Qa("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Qa("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let kd=null;function Ad(){return null===kd?kd=268435456+Math.round(2147483648*Math.random()):kd++,"0x"+kd.toString(16)}const Nd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Rd{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const Dd="WebChannelConnection";class Pd extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,i){const s=Ad(),o=this.bo(e,t);Qa("RestConnection",`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(e,o,a,n).then((t=>(Qa("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw Xa("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,i,s){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ha,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=Nd[e];return`${this.fo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const i=Ad();return new Promise(((s,o)=>{const a=new Ba;a.setWithCredentials(!0),a.listenOnce(Ua.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case xa.NO_ERROR:const t=a.getResponseJson();Qa(Dd,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case xa.TIMEOUT:Qa(Dd,`RPC '${e}' ${i} timed out`),o(new rc(nc.DEADLINE_EXCEEDED,"Request time out"));break;case xa.HTTP_ERROR:const n=a.getStatus();if(Qa(Dd,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(nc).indexOf(t)>=0?t:nc.UNKNOWN}(t.status);o(new rc(e,t.message))}else o(new rc(nc.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new rc(nc.UNAVAILABLE,"Connection failed."));break;default:Za()}}finally{Qa(Dd,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);Qa(Dd,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=Ad(),i=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=La(),o=Ma(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");Qa(Dd,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,d=!1;const f=new Rd({lo:t=>{d?Qa(Dd,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(Qa(Dd,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),Qa(Dd,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},ho:()=>l.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(l,ja.EventType.OPEN,(()=>{d||Qa(Dd,`RPC '${e}' stream ${r} transport opened.`)})),p(l,ja.EventType.CLOSE,(()=>{d||(d=!0,Qa(Dd,`RPC '${e}' stream ${r} transport closed`),f.Vo())})),p(l,ja.EventType.ERROR,(t=>{d||(d=!0,Xa(Dd,`RPC '${e}' stream ${r} transport errored:`,t),f.Vo(new rc(nc.UNAVAILABLE,"The operation could not be completed")))})),p(l,ja.EventType.MESSAGE,(t=>{var n;if(!d){const i=t.data[0];ec(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Qa(Dd,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=eh[e];if(void 0!==t)return nh(t)}(t),i=o.message;void 0===n&&(n=nc.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new rc(n,i)),l.close()}else Qa(Dd,`RPC '${e}' stream ${r} received:`,i),f.mo(i)}})),p(o,Fa.STAT_EVENT,(t=>{t.stat===Va.PROXY?Qa(Dd,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===Va.NOPROXY&&Qa(Dd,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function Od(){return"undefined"!=typeof document?document:null}function Ld(e){return new _h(e,!0)}class Md{constructor(e,t,n=1e3,r=1.5,i=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,t-n);r>0&&Qa("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class xd{constructor(e,t,n,r,i,s,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Md(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===nc.RESOURCE_EXHAUSTED?(Ja(t.toString()),Ja("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===nc.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new rc(nc.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return Qa("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(Qa("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ud extends xd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Za()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(ec(void 0===t||"string"==typeof t),Kc.fromBase64String(t||"")):(ec(void 0===t||t instanceof Uint8Array),Kc.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?nc.UNKNOWN:nh(e.code);return new rc(t,e.message||"")}(o);n=new dh(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Nh(e,r.document.name),s=Sh(r.document.updateTime),o=r.document.createTime?Sh(r.document.createTime):vc.min(),a=new yu({mapValue:{fields:r.document.fields}}),c=wu.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new lh(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Nh(e,r.document),s=r.readTime?Sh(r.readTime):vc.min(),o=wu.newNoDocument(i,s),a=r.removedTargetIds||[];n=new lh([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Nh(e,r.document),s=r.removedTargetIds||[];n=new lh([],s,i,null)}else{if(!("filter"in t))return Za();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Zl(r,i),o=e.targetId;n=new hh(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return vc.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?vc.min():t.readTime?Sh(t.readTime):vc.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=Dh(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Ku(r)?{documents:Lh(e,r)}:{query:Mh(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ih(e,t.resumeToken);const r=Eh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(vc.min())>0){n.readTime=bh(e,t.snapshotVersion.toTimestamp());const r=Eh(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Za()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=Dh(this.serializer),t.removeTarget=e,this.t_(t)}}class Fd extends xd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(ec(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(ec(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Sh(e.updateTime):Sh(t);return n.isEqual(vc.min())&&(n=Sh(t)),new Ll(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Sh(e.commitTime);return this.listener.T_(n,t)}return ec(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=Dh(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof ql)n={update:Oh(e,t.key,t.value)};else if(t instanceof Wl)n={delete:Ah(e,t.key)};else if(t instanceof zl)n={update:Oh(e,t.key,t.data),updateMask:zh(t.fieldMask)};else{if(!(t instanceof Ql))return Za();n={verify:Ah(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Cl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof kl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Nl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Dl)return{fieldPath:t.field.canonicalString(),increment:n.Te};throw Za()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Th(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Za()}(e,t.precondition)),n}(this.serializer,e)))};this.t_(t)}}class Vd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new rc(nc.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.So(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===nc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rc(nc.UNKNOWN,e.toString())}))}vo(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.vo(e,t,n,i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===nc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new rc(nc.UNKNOWN,e.toString())}))}terminate(){this.A_=!0}}class jd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Ja(t),this.g_=!1):Qa("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Bd{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((e=>{n.enqueueAndForget((async()=>{Jd(this)&&(Qa("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=tc(e);t.v_.add(4),await qd(t),t.x_.set("Unknown"),t.v_.delete(4),await $d(t)}(this))}))})),this.x_=new jd(n,r)}}async function $d(e){if(Jd(e))for(const t of e.F_)await t(!0)}async function qd(e){for(const t of e.F_)await t(!1)}function zd(e,t){const n=tc(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),Qd(n)?Wd(n):pf(n).Jo()&&Hd(n,t))}function Kd(e,t){const n=tc(e),r=pf(n);n.C_.delete(t),r.Jo()&&Gd(n,t),0===n.C_.size&&(r.Jo()?r.Xo():Jd(n)&&n.x_.set("Unknown"))}function Hd(e,t){if(e.O_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(vc.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}pf(e).c_(t)}function Gd(e,t){e.O_.Ne(t),pf(e).l_(t)}function Wd(e){e.O_=new ph({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ut:t=>e.C_.get(t)||null,rt:()=>e.datastore.serializer.databaseId}),pf(e).start(),e.x_.p_()}function Qd(e){return Jd(e)&&!pf(e).Ho()&&e.C_.size>0}function Jd(e){return 0===tc(e).v_.size}function Xd(e){e.O_=void 0}async function Yd(e){e.C_.forEach(((t,n)=>{Hd(e,t)}))}async function Zd(e,t){Xd(e),Qd(e)?(e.x_.S_(t),Wd(e)):e.x_.set("Unknown")}async function ef(e,t,n){if(e.x_.set("Online"),t instanceof dh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){Qa("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await tf(e,n)}else if(t instanceof lh?e.O_.Ue(t):t instanceof hh?e.O_.Ye(t):e.O_.ze(t),!n.isEqual(vc.min()))try{const t=await wd(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.st(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.C_.get(r);i&&e.C_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(Kc.EMPTY_BYTE_STRING,r.snapshotVersion)),Gd(e,t);const i=new Hh(r.target,t,n,r.sequenceNumber);Hd(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Qa("RemoteStore","Failed to raise snapshot:",t),await tf(e,t)}}async function tf(e,t,n){if(!Dc(t))throw t;e.v_.add(1),await qd(e),e.x_.set("Offline"),n||(n=()=>wd(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Qa("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await $d(e)}))}function nf(e,t){return t().catch((n=>tf(e,n,t)))}async function rf(e){const t=tc(e),n=gf(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;sf(t);)try{const e=await _d(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,of(t,e)}catch(e){await tf(t,e)}af(t)&&cf(t)}function sf(e){return Jd(e)&&e.D_.length<10}function of(e,t){e.D_.push(t);const n=gf(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function af(e){return Jd(e)&&!gf(e).Ho()&&e.D_.length>0}function cf(e){gf(e).start()}async function uf(e){gf(e).d_()}async function lf(e){const t=gf(e);for(const n of e.D_)t.I_(n.mutations)}async function hf(e,t,n){const r=e.D_.shift(),i=Xl.from(r,t,n);await nf(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await rf(e)}async function df(e,t){t&&gf(e).P_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return Za();case nc.CANCELLED:case nc.UNKNOWN:case nc.DEADLINE_EXCEEDED:case nc.RESOURCE_EXHAUSTED:case nc.INTERNAL:case nc.UNAVAILABLE:case nc.UNAUTHENTICATED:return!1;case nc.INVALID_ARGUMENT:case nc.NOT_FOUND:case nc.ALREADY_EXISTS:case nc.PERMISSION_DENIED:case nc.FAILED_PRECONDITION:case nc.ABORTED:case nc.OUT_OF_RANGE:case nc.UNIMPLEMENTED:case nc.DATA_LOSS:return!0}}(e)&&e!==nc.ABORTED}(t.code)){const n=e.D_.shift();gf(e).Zo(),await nf(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await rf(e)}}(e,t),af(e)&&cf(e)}async function ff(e,t){const n=tc(e);n.asyncQueue.verifyOperationInProgress(),Qa("RemoteStore","RemoteStore received new credentials");const r=Jd(n);n.v_.add(3),await qd(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await $d(n)}function pf(e){return e.N_||(e.N_=function(e,t,n){const r=tc(e);return r.R_(),new Ud(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Yd.bind(null,e),To:Zd.bind(null,e),u_:ef.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),Qd(e)?Wd(e):e.x_.set("Unknown")):(await e.N_.stop(),Xd(e))}))),e.N_}function gf(e){return e.B_||(e.B_=function(e,t,n){const r=tc(e);return r.R_(),new Fd(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:uf.bind(null,e),To:df.bind(null,e),E_:lf.bind(null,e),T_:hf.bind(null,e)}),e.F_.push((async t=>{t?(e.B_.Zo(),await rf(e)):(await e.B_.stop(),e.D_.length>0&&(Qa("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.B_}class mf{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ic,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new mf(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new rc(nc.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function yf(e,t){if(Ja("AsyncQueue",`${t}: ${e}`),Dc(e))return new rc(nc.UNAVAILABLE,`${t}: ${e}`);throw e}class vf{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ic.comparator(t.key,n.key):(e,t)=>Ic.comparator(e.key,t.key),this.keyedMap=ll(),this.sortedSet=new Fc(this.comparator)}static emptySet(e){return new vf(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof vf))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new vf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class wf{constructor(){this.L_=new Fc(Ic.comparator)}track(e){const t=e.doc.key,n=this.L_.get(t);n?0!==e.type&&3===n.type?this.L_=this.L_.insert(t,e):3===e.type&&1!==n.type?this.L_=this.L_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.L_=this.L_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.L_=this.L_.remove(t):1===e.type&&2===n.type?this.L_=this.L_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.L_=this.L_.insert(t,{type:2,doc:e.doc}):Za():this.L_=this.L_.insert(t,e)}k_(){const e=[];return this.L_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class _f{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new _f(e,t,vf.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&el(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Ef{constructor(){this.q_=void 0,this.listeners=[]}}class bf{constructor(){this.queries=new ol((e=>tl(e)),el),this.onlineState="Unknown",this.Q_=new Set}}function If(e,t){const n=tc(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.U_(e)&&(r=!0);i.q_=e}}r&&Sf(n)}function Tf(e,t,n){const r=tc(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function Sf(e){e.Q_.forEach((e=>{e.next()}))}class Cf{constructor(e,t,n){this.query=e,this.W_=t,this.G_=!1,this.z_=null,this.onlineState="Unknown",this.options=n||{}}U_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new _f(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.G_?this.j_(e)&&(this.W_.next(e),t=!0):this.H_(e,this.onlineState)&&(this.J_(e),t=!0),this.z_=e,t}onError(e){this.W_.error(e)}K_(e){this.onlineState=e;let t=!1;return this.z_&&!this.G_&&this.H_(this.z_,e)&&(this.J_(this.z_),t=!0),t}H_(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Y_||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}j_(e){if(e.docChanges.length>0)return!0;const t=this.z_&&this.z_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}J_(e){e=_f.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.G_=!0,this.W_.next(e)}}class kf{constructor(e){this.key=e}}class Af{constructor(e){this.key=e}}class Nf{constructor(e,t){this.query=e,this.sa=t,this.oa=null,this.hasCachedResults=!1,this.current=!1,this._a=yl(),this.mutatedKeys=yl(),this.aa=il(e),this.ua=new vf(this.aa)}get ca(){return this.sa}la(e,t){const n=t?t.ha:new wf,r=t?t.ua:this.ua;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=rl(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Pa(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.aa(l,a)>0||c&&this.aa(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ua:s,ha:n,Xi:o,mutatedKeys:i}}Pa(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.ua;this.ua=e.ua,this.mutatedKeys=e.mutatedKeys;const i=e.ha.k_();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Za()}};return n(e)-n(t)}(e.type,t.type)||this.aa(e.doc,t.doc))),this.Ia(n);const s=t?this.Ta():[],o=0===this._a.size&&this.current?1:0,a=o!==this.oa;return this.oa=o,0!==i.length||a?{snapshot:new _f(this.query,e.ua,r,i,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ea:s}:{Ea:s}}K_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ua:this.ua,ha:new wf,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Ea:[]}}da(e){return!this.sa.has(e)&&!!this.ua.has(e)&&!this.ua.get(e).hasLocalMutations}Ia(e){e&&(e.addedDocuments.forEach((e=>this.sa=this.sa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.sa=this.sa.delete(e))),this.current=e.current)}Ta(){if(!this.current)return[];const e=this._a;this._a=yl(),this.ua.forEach((e=>{this.da(e.key)&&(this._a=this._a.add(e.key))}));const t=[];return e.forEach((e=>{this._a.has(e)||t.push(new Af(e))})),this._a.forEach((n=>{e.has(n)||t.push(new kf(n))})),t}Aa(e){this.sa=e.hs,this._a=yl();const t=this.la(e.documents);return this.applyChanges(t,!0)}Ra(){return _f.fromInitialDocuments(this.query,this.ua,this.mutatedKeys,0===this.oa,this.hasCachedResults)}}class Rf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Df{constructor(e){this.key=e,this.Va=!1}}class Pf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.ma={},this.fa=new ol((e=>tl(e)),el),this.ga=new Map,this.pa=new Set,this.ya=new Fc(Ic.comparator),this.wa=new Map,this.Sa=new sd,this.ba={},this.Da=new Map,this.Ca=Zh.Bn(),this.onlineState="Unknown",this.va=void 0}get isPrimaryClient(){return!0===this.va}}async function Of(e,t){const n=function(e){const t=tc(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Mf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Qf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Uf.bind(null,t),t.ma.u_=If.bind(null,t.eventManager),t.ma.Ma=Tf.bind(null,t.eventManager),t}(e);let r,i;const s=n.fa.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Ra();else{const e=await function(e,t){const n=tc(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((i=>i?(r=i,Rc.resolve(r)):n.Qr.allocateTargetId(e).next((i=>(r=new Hh(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}(n.localStore,Xu(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await async function(e,t,n,r,i){e.Fa=(t,n,r)=>async function(e,t,n,r){let i=t.view.la(n);i.Xi&&(i=await bd(e.localStore,t.query,!1).then((({documents:e})=>t.view.la(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return zf(e,t.targetId,o.Ea),o.snapshot}(e,t,n,r);const s=await bd(e.localStore,t,!0),o=new Nf(t,s.hs),a=o.la(s.documents),c=uh.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);zf(e,n,u.Ea);const l=new Rf(t,n,o);return e.fa.set(t,l),e.ga.has(n)?e.ga.get(n).push(t):e.ga.set(n,[t]),u.snapshot}(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&zd(n.remoteStore,e)}return i}async function Lf(e,t){const n=tc(e),r=n.fa.get(t),i=n.ga.get(r.targetId);if(i.length>1)return n.ga.set(r.targetId,i.filter((e=>!el(e,t)))),void n.fa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Ed(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Kd(n.remoteStore,r.targetId),$f(n,r.targetId)})).catch(Nc)):($f(n,r.targetId),await Ed(n.localStore,r.targetId,!0))}async function Mf(e,t){const n=tc(e);try{const e=await function(e,t){const n=tc(e),r=t.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Kc.EMPTY_BYTE_STRING,vc.min()).withLastLimboFreeSnapshotVersion(vc.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(e,u))}));let a=cl(),c=yl();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=yl(),i=yl();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=cl();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(vc.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):Qa("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(vc.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Rc.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.wa.get(t);r&&(ec(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Va=!0:e.modifiedDocuments.size>0?ec(r.Va):e.removedDocuments.size>0&&(ec(r.Va),r.Va=!1))})),await Gf(n,e,t)}catch(e){await Nc(e)}}function xf(e,t,n){const r=tc(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.fa.forEach(((n,r)=>{const i=r.view.K_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=tc(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.K_(t)&&(r=!0)})),r&&Sf(n)}(r.eventManager,t),e.length&&r.ma.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Uf(e,t,n){const r=tc(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.wa.get(t),s=i&&i.key;if(s){let e=new Fc(Ic.comparator);e=e.insert(s,wu.newNoDocument(s,vc.min()));const n=yl().add(s),i=new ch(vc.min(),new Map,new Fc(gc),e,n);await Mf(r,i),r.ya=r.ya.remove(s),r.wa.delete(t),Hf(r)}else await Ed(r.localStore,t,!1).then((()=>$f(r,t,n))).catch(Nc)}async function Ff(e,t){const n=tc(e),r=t.batch.batchId;try{const e=await function(e,t){const n=tc(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Rc.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);ec(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=yl();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Bf(n,r,null),jf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Gf(n,e)}catch(e){await Nc(e)}}async function Vf(e,t,n){const r=tc(e);try{const e=await function(e,t){const n=tc(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ec(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Bf(r,t,n),jf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Gf(r,e)}catch(n){await Nc(n)}}function jf(e,t){(e.Da.get(t)||[]).forEach((e=>{e.resolve()})),e.Da.delete(t)}function Bf(e,t,n){const r=tc(e);let i=r.ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.ba[r.currentUser.toKey()]=i}}function $f(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.ga.get(t))e.fa.delete(r),n&&e.ma.Ma(r,n);e.ga.delete(t),e.isPrimaryClient&&e.Sa.Vr(t).forEach((t=>{e.Sa.containsKey(t)||qf(e,t)}))}function qf(e,t){e.pa.delete(t.path.canonicalString());const n=e.ya.get(t);null!==n&&(Kd(e.remoteStore,n),e.ya=e.ya.remove(t),e.wa.delete(n),Hf(e))}function zf(e,t,n){for(const r of n)r instanceof kf?(e.Sa.addReference(r.key,t),Kf(e,r)):r instanceof Af?(Qa("SyncEngine","Document no longer in limbo: "+r.key),e.Sa.removeReference(r.key,t),e.Sa.containsKey(r.key)||qf(e,r.key)):Za()}function Kf(e,t){const n=t.key,r=n.path.canonicalString();e.ya.get(n)||e.pa.has(r)||(Qa("SyncEngine","New document in limbo: "+n),e.pa.add(r),Hf(e))}function Hf(e){for(;e.pa.size>0&&e.ya.size<e.maxConcurrentLimboResolutions;){const t=e.pa.values().next().value;e.pa.delete(t);const n=new Ic(_c.fromString(t)),r=e.Ca.next();e.wa.set(r,new Df(n)),e.ya=e.ya.insert(n,r),zd(e.remoteStore,new Hh(Xu(Gu(n.path)),r,"TargetPurposeLimboResolution",Pc.ae))}}async function Gf(e,t,n){const r=tc(e),i=[],s=[],o=[];r.fa.isEmpty()||(r.fa.forEach(((e,a)=>{o.push(r.Fa(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){i.push(e);const t=pd.Ki(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.ma.u_(i),await async function(e,t){const n=tc(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Rc.forEach(t,(t=>Rc.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Rc.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Dc(e))throw e;Qa("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,i)}}}(r.localStore,s))}async function Wf(e,t){const n=tc(e);if(!n.currentUser.isEqual(t)){Qa("SyncEngine","User change. New user:",t.toKey());const e=await vd(n.localStore,t);n.currentUser=t,function(e,t){e.Da.forEach((e=>{e.forEach((e=>{e.reject(new rc(nc.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Da.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Gf(n,e.us)}}function Qf(e,t){const n=tc(e),r=n.wa.get(t);if(r&&r.Va)return yl().add(r.key);{let e=yl();const r=n.ga.get(t);if(!r)return e;for(const t of r){const r=n.fa.get(t);e=e.unionWith(r.view.ca)}return e}}function Jf(e){const t=tc(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ff.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Vf.bind(null,t),t}class Xf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Ld(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,r){return new yd(e,t,n,r)}(this.persistence,new md,e.initialUser,this.serializer)}createPersistence(e){return new hd(fd.Hr,this.serializer)}createSharedClientState(e){return new Td}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>xf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wf.bind(null,this.syncEngine),await async function(e,t){const n=tc(e);t?(n.v_.delete(2),await $d(n)):t||(n.v_.add(2),await qd(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new bf}createDatastore(e){const t=Ld(e.databaseInfo.databaseId),n=function(e){return new Pd(e)}(e.databaseInfo);return function(e,t,n,r){return new Vd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Bd(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>xf(this.syncEngine,e,0)),Cd.C()?new Cd:new Sd)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Pf(e,t,n,r,i,s);return o&&(a.va=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=tc(e);Qa("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await qd(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore)}}class Zf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Na(this.observer.next,e)}error(e){this.observer.error?this.Na(this.observer.error,e):Ja("Uncaught Error in snapshot listener:",e.toString())}Ba(){this.muted=!0}Na(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class ep{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ka.UNAUTHENTICATED,this.clientId=pc.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Qa("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Qa("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new rc(nc.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ic;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=yf(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function tp(e,t){e.asyncQueue.verifyOperationInProgress(),Qa("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await vd(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function np(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Qa("FirestoreClient","Using user provided OfflineComponentProvider");try{await tp(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===nc.FAILED_PRECONDITION||e.code===nc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;Xa("Error using user provided cache. Falling back to memory cache: "+n),await tp(e,new Xf)}}else Qa("FirestoreClient","Using default OfflineComponentProvider"),await tp(e,new Xf);return e._offlineComponents}(e);Qa("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>ff(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>ff(t.remoteStore,n))),e._onlineComponents=t}async function rp(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Qa("FirestoreClient","Using user provided OnlineComponentProvider"),await np(e,e._uninitializedComponentsProvider._online)):(Qa("FirestoreClient","Using default OnlineComponentProvider"),await np(e,new Yf))),e._onlineComponents}async function ip(e){const t=await rp(e),n=t.eventManager;return n.onListen=Of.bind(null,t.syncEngine),n.onUnlisten=Lf.bind(null,t.syncEngine),n}function sp(e,t,n={}){const r=new ic;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Zf({next:n=>{t.enqueueAndForget((()=>async function(e,t){const n=tc(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}(e,o))),n.fromCache&&"server"===r.source?i.reject(new rc(nc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Cf(n,s,{includeMetadataChanges:!0,Y_:!0});return async function(e,t){const n=tc(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Ef),i)try{s.q_=await n.onListen(r)}catch(e){const n=yf(e,`Initialization of query '${nl(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.K_(n.onlineState),s.q_&&t.U_(s.q_)&&Sf(n)}(e,o)}(await ip(e),e.asyncQueue,t,n,r))),r.promise}function op(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ap=new Map;function cp(e,t,n){if(!n)throw new rc(nc.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function up(e){if(!Ic.isDocumentKey(e))throw new rc(nc.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function lp(e){if(Ic.isDocumentKey(e))throw new rc(nc.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Za()}function dp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new rc(nc.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=hp(e);throw new rc(nc.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class fp{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new rc(nc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new rc(nc.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new rc(nc.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=op(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new rc(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new rc(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new rc(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class pp{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fp({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new rc(nc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new rc(nc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fp(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new oc;switch(e.type){case"firstParty":return new lc(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new rc(nc.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ap.get(e);t&&(Qa("ComponentProvider","Removing Datastore"),ap.delete(e),t.terminate())}(this),Promise.resolve()}}class gp{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gp(this.firestore,e,this._query)}}class mp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yp(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new mp(this.firestore,e,this._key)}}class yp extends gp{constructor(e,t,n){super(e,t,Gu(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new mp(this.firestore,null,new Ic(e))}withConverter(e){return new yp(this.firestore,e,this._path)}}function vp(e,t,...n){if(e=P(e),cp("collection","path",t),e instanceof pp){const r=_c.fromString(t,...n);return lp(r),new yp(e,null,r)}{if(!(e instanceof mp||e instanceof yp))throw new rc(nc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_c.fromString(t,...n));return lp(r),new yp(e.firestore,null,r)}}class wp{constructor(){this.Ya=Promise.resolve(),this.Za=[],this.Xa=!1,this.eu=[],this.tu=null,this.nu=!1,this.ru=!1,this.iu=[],this.jo=new Md(this,"async_queue_retry"),this.su=()=>{const e=Od();e&&Qa("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=Od();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.su)}get isShuttingDown(){return this.Xa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ou(),this._u(e)}enterRestrictedMode(e){if(!this.Xa){this.Xa=!0,this.ru=e||!1;const t=Od();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.su)}}enqueue(e){if(this.ou(),this.Xa)return new Promise((()=>{}));const t=new ic;return this._u((()=>this.Xa&&this.ru?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Za.push(e),this.au())))}async au(){if(0!==this.Za.length){try{await this.Za[0](),this.Za.shift(),this.jo.reset()}catch(e){if(!Dc(e))throw e;Qa("AsyncQueue","Operation failed with retryable error: "+e)}this.Za.length>0&&this.jo.qo((()=>this.au()))}}_u(e){const t=this.Ya.then((()=>(this.nu=!0,e().catch((e=>{this.tu=e,this.nu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Ja("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.nu=!1,e))))));return this.Ya=t,t}enqueueAfterDelay(e,t,n){this.ou(),this.iu.indexOf(e)>-1&&(t=0);const r=mf.createAndSchedule(this,e,t,n,(e=>this.uu(e)));return this.eu.push(r),r}ou(){this.tu&&Za()}verifyOperationInProgress(){}async cu(){let e;do{e=this.Ya,await e}while(e!==this.Ya)}lu(e){for(const t of this.eu)if(t.timerId===e)return!0;return!1}hu(e){return this.cu().then((()=>{this.eu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.eu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.cu()}))}Pu(e){this.iu.push(e)}uu(e){const t=this.eu.indexOf(e);this.eu.splice(t,1)}}class _p extends pp{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new wp,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||bp(this),this._firestoreClient.terminate()}}function Ep(e){return e._firestoreClient||bp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function bp(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Zc(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,op(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._firestoreClient=new ep(e._authCredentials,e._appCheckCredentials,e._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ip{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ip(Kc.fromBase64String(e))}catch(e){throw new rc(nc.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ip(Kc.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Tp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new rc(nc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bc(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Sp{constructor(e){this._methodName=e}}class Cp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new rc(nc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new rc(nc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return gc(this._lat,e._lat)||gc(this._long,e._long)}}const kp=/^__.*__$/;class Ap{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new zl(e,this.data,this.fieldMask,t,this.fieldTransforms):new ql(e,this.data,t,this.fieldTransforms)}}function Np(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Za()}}class Rp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Iu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Tu(){return this.settings.Tu}Eu(e){return new Rp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}du(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Eu({path:n,Au:!1});return r.Ru(e),r}Vu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Eu({path:n,Au:!1});return r.Iu(),r}mu(e){return this.Eu({path:void 0,Au:!0})}fu(e){return Bp(e,this.settings.methodName,this.settings.gu||!1,this.path,this.settings.pu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Iu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ru(this.path.get(e))}Ru(e){if(0===e.length)throw this.fu("Document fields must not be empty");if(Np(this.Tu)&&kp.test(e))throw this.fu('Document fields cannot begin and end with "__"')}}class Dp{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ld(e)}yu(e,t,n,r=!1){return new Rp({Tu:e,methodName:t,pu:n,path:bc.emptyPath(),Au:!1,gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Pp(e){const t=e._freezeSettings(),n=Ld(e._databaseId);return new Dp(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Op(e,t,n,r,i,s={}){const o=e.yu(s.merge||s.mergeFields?2:0,t,n,i);Up("Data must be an object, but it was:",o,r);const a=Mp(r,o);let c,u;if(s.merge)c=new qc(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Fp(t,r,n);if(!o.contains(i))throw new rc(nc.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);$p(e,i)||e.push(i)}c=new qc(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Ap(new yu(a),c,u)}function Lp(e,t){if(xp(e=P(e)))return Up("Unsupported field value:",t,e),Mp(e,t);if(e instanceof Sp)return function(e,t){if(!Np(t.Tu))throw t.fu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.fu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Au&&4!==t.Tu)throw t.fu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Lp(i,t.mu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=P(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return El(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=yc.fromDate(e);return{timestampValue:bh(t.serializer,n)}}if(e instanceof yc){const n=new yc(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:bh(t.serializer,n)}}if(e instanceof Cp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ip)return{bytesValue:Ih(t.serializer,e._byteString)};if(e instanceof mp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.fu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ch(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.fu(`Unsupported field value: ${hp(e)}`)}(e,t)}function Mp(e,t){const n={};return Uc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):xc(e,((e,r)=>{const i=Lp(r,t.du(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function xp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof yc||e instanceof Cp||e instanceof Ip||e instanceof mp||e instanceof Sp)}function Up(e,t,n){if(!xp(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=hp(n);throw"an object"===r?t.fu(e+" a custom object"):t.fu(e+" "+r)}}function Fp(e,t,n){if((t=P(t))instanceof Tp)return t._internalPath;if("string"==typeof t)return jp(e,t);throw Bp("Field path arguments must be of type string or ",e,!1,void 0,n)}const Vp=new RegExp("[~\\*/\\[\\]]");function jp(e,t,n){if(t.search(Vp)>=0)throw Bp(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Tp(...t.split("."))._internalPath}catch(r){throw Bp(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Bp(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new rc(nc.INVALID_ARGUMENT,a+e+c)}function $p(e,t){return e.some((e=>e.isEqual(t)))}class qp{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new mp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new zp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Kp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class zp extends qp{data(){return super.data()}}function Kp(e,t){return"string"==typeof t?jp(e,t):t instanceof Tp?t._internalPath:t._delegate._internalPath}class Hp{}class Gp extends Hp{}function Wp(e,t,...n){let r=[];t instanceof Hp&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Xp)).length,n=e.filter((e=>e instanceof Qp)).length;if(t>1||t>0&&n>0)throw new rc(nc.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Qp extends Gp{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Qp(e,t,n)}_apply(e){const t=this._parse(e);return eg(e._query,t),new gp(e.firestore,e.converter,Yu(e._query,t))}_parse(e){const t=Pp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new rc(nc.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Zp(o,s);const t=[];for(const n of o)t.push(Yp(r,e,n));a={arrayValue:{values:t}}}else a=Yp(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Zp(o,s),a=function(e,t,n,r=!1){return Lp(n,e.yu(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return Cu.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Jp(e,t,n){const r=t,i=Kp("where",e);return Qp._create(i,r,n)}class Xp extends Hp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Xp(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:ku.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)eg(n,e),n=Yu(n,e)}(e._query,t),new gp(e.firestore,e.converter,Yu(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Yp(e,t,n){if("string"==typeof(n=P(n))){if(""===n)throw new rc(nc.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Qu(t)&&-1!==n.indexOf("/"))throw new rc(nc.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(_c.fromString(n));if(!Ic.isDocumentKey(r))throw new rc(nc.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return uu(e,new Ic(r))}if(n instanceof mp)return uu(e,n._key);throw new rc(nc.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hp(n)}.`)}function Zp(e,t){if(!Array.isArray(e)||0===e.length)throw new rc(nc.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function eg(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new rc(nc.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rc(nc.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class tg{convertValue(e,t="none"){switch(nu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Wc(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qc(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Za()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return xc(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Cp(Wc(e.latitude),Wc(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Xc(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Yc(e));default:return null}}convertTimestamp(e){const t=Gc(e);return new yc(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=_c.fromString(e);ec(Kh(n));const r=new eu(n.get(1),n.get(3)),i=new Ic(n.popFirst(5));return r.isEqual(t)||Ja(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class ng{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rg extends qp{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ig(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Kp("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class ig extends rg{data(e={}){return super.data(e)}}class sg{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ng(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new ig(this._firestore,this._userDataWriter,n.key,n,new ng(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new rc(nc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new ig(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ng(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new ig(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ng(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:og(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function og(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Za()}}class ag extends tg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ip(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new mp(this.firestore,null,t)}}function cg(e){e=dp(e,gp);const t=dp(e.firestore,_p),n=Ep(t),r=new ag(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new rc(nc.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),sp(n,e._query).then((n=>new sg(t,r,e,n)))}function ug(e,t){return function(e,t){const n=new ic;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Jf(e);try{const e=await function(e,t){const n=tc(e),r=yc.now(),i=t.reduce(((e,t)=>e.add(t.key)),yl());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=cl(),c=yl();return n.os.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Bl(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new zl(e.key,t,vu(t.value.mapValue),Ml.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:hl(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.ba[e.currentUser.toKey()];r||(r=new Fc(gc)),r=r.insert(t,n),e.ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await Gf(r,e.changes),await rf(r.remoteStore)}catch(e){const t=yf(e,"Failed to persist write");n.reject(t)}}(await function(e){return rp(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Ep(e),t)}new WeakMap,function(e,t=!0){!function(e){Ha=e}(Ee),ye(new O("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new _p(new cc(e.getProvider("auth-internal")),new dc(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new rc(nc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new eu(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),Te(za,"4.3.0",e),Te(za,"4.3.0","esm2017")}();const lg=(e,t)=>t.some((t=>e instanceof t));let hg,dg;const fg=new WeakMap,pg=new WeakMap,gg=new WeakMap,mg=new WeakMap,yg=new WeakMap;let vg={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return pg.get(e);if("objectStoreNames"===t)return e.objectStoreNames||gg.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _g(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function wg(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(dg||(dg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Eg(this),e),_g(fg.get(this))}:function(...e){return _g(t.apply(Eg(this),e))}:function(e,...n){const r=t.call(Eg(this),e,...n);return gg.set(r,e.sort?e.sort():[e]),_g(r)}:(e instanceof IDBTransaction&&function(e){if(pg.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));pg.set(e,t)}(e),lg(e,hg||(hg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,vg):e);var t}function _g(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(_g(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&fg.set(t,e)})).catch((()=>{})),yg.set(t,e),t}(e);if(mg.has(e))return mg.get(e);const t=wg(e);return t!==e&&(mg.set(e,t),yg.set(t,e)),t}const Eg=e=>yg.get(e),bg=["get","getKey","getAll","getAllKeys","count"],Ig=["put","add","delete","clear"],Tg=new Map;function Sg(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Tg.get(t))return Tg.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=Ig.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!bg.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Tg.set(t,s),s}vg=(e=>({...e,get:(t,n,r)=>Sg(t,n)||e.get(t,n,r),has:(t,n)=>!!Sg(t,n)||e.has(t,n)}))(vg);const Cg="@firebase/installations",kg="0.6.4",Ag=1e4,Ng=`w:${kg}`,Rg="FIS_v2",Dg="https://firebaseinstallations.googleapis.com/v1",Pg=36e5,Og=new v("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Lg(e){return e instanceof y&&e.code.includes("request-failed")}function Mg({projectId:e}){return`${Dg}/projects/${e}/installations`}function xg(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Ug(e,t){const n=(await t.json()).error;return Og.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Fg({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function Vg(e){const t=await e();return t.status>=500&&t.status<600?e():t}function jg(e){return new Promise((t=>{setTimeout(t,e)}))}const Bg=/^[cdef][\w-]{21}$/,$g="";function qg(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return Bg.test(t)?t:$g}catch(e){return $g}}function zg(e){return`${e.appName}!${e.appId}`}const Kg=new Map;function Hg(e,t){const n=zg(e);Gg(n,t),function(e,t){const n=(!Wg&&"BroadcastChannel"in self&&(Wg=new BroadcastChannel("[Firebase] FID Change"),Wg.onmessage=e=>{Gg(e.data.key,e.data.fid)}),Wg);n&&n.postMessage({key:e,fid:t}),0===Kg.size&&Wg&&(Wg.close(),Wg=null)}(n,t)}function Gg(e,t){const n=Kg.get(e);if(n)for(const e of n)e(t)}let Wg=null;const Qg="firebase-installations-database",Jg=1,Xg="firebase-installations-store";let Yg=null;function Zg(){return Yg||(Yg=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=_g(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(_g(o.result),e.oldVersion,e.newVersion,_g(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}(Qg,Jg,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Xg)}})),Yg}async function em(e,t){const n=zg(e),r=(await Zg()).transaction(Xg,"readwrite"),i=r.objectStore(Xg),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||Hg(e,t.fid),t}async function tm(e){const t=zg(e),n=(await Zg()).transaction(Xg,"readwrite");await n.objectStore(Xg).delete(t),await n.done}async function nm(e,t){const n=zg(e),r=(await Zg()).transaction(Xg,"readwrite"),i=r.objectStore(Xg),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||Hg(e,o.fid),o}async function rm(e){let t;const n=await nm(e.appConfig,(n=>{const r=function(e){return om(e||{fid:qg(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Og.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Mg(e),i=Fg(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:Rg,appId:e.appId,sdkVersion:Ng},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Vg((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:xg(e.authToken)}}throw await Ug("Create Installation",c)}(e,t);return em(e.appConfig,n)}catch(n){throw Lg(n)&&409===n.customData.serverCode?await tm(e.appConfig):await em(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:im(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return n.fid===$g?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function im(e){let t=await sm(e.appConfig);for(;1===t.registrationStatus;)await jg(100),t=await sm(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await rm(e);return n||t}return t}function sm(e){return nm(e,(e=>{if(!e)throw Og.create("installation-not-found");return om(e)}))}function om(e){return 1===(t=e).registrationStatus&&t.registrationTime+Ag<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function am({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${Mg(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=Fg(e);return n.append("Authorization",function(e){return`${Rg} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:Ng,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await Vg((()=>fetch(r,a)));if(c.ok)return xg(await c.json());throw await Ug("Generate Auth Token",c)}async function cm(e,t=!1){let n;const r=await nm(e.appConfig,(r=>{if(!lm(r))throw Og.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Pg}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await um(e.appConfig);for(;1===n.authToken.requestStatus;)await jg(100),n=await um(e.appConfig);const r=n.authToken;return 0===r.requestStatus?cm(e,t):r}(e,t),r;{if(!navigator.onLine)throw Og.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await am(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await em(e.appConfig,r),n}catch(n){if(!Lg(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await em(e.appConfig,n)}else await tm(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function um(e){return nm(e,(e=>{if(!lm(e))throw Og.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+Ag<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function lm(e){return void 0!==e&&2===e.registrationStatus}function hm(e){return Og.create("missing-app-config-values",{valueName:e})}const dm="installations";ye(new O(dm,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw hm("App Configuration");if(!e.name)throw hm("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw hm(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:ve(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ye(new O("installations-internal",(e=>{const t=ve(e.getProvider("app").getImmediate(),dm).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await rm(t);return r?r.catch(console.error):cm(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await rm(e);t&&await t}(n),(await cm(n,t)).token}(t,e)}}),"PRIVATE")),Te(Cg,kg),Te(Cg,kg,"esm2017");const fm="analytics",pm="firebase_id",gm="origin",mm=6e4,ym="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",vm="https://www.googletagmanager.com/gtag/js",wm=new z("@firebase/analytics"),_m=new v("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Em(e){if(!e.startsWith(vm)){const t=_m.create("invalid-gtag-resource",{gtagURL:e});return wm.warn(t.message),""}return e}function bm(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Im=30,Tm=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Sm(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Cm(e,t=Tm,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw _m.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw _m.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Am;return setTimeout((async()=>{a.abort()}),void 0!==n?n:mm),km({appId:r,apiKey:i,measurementId:s},o,a,t)}async function km(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Tm){var s;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(_m.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(a)return wm.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:Sm(r)},s=ym.replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw _m.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const c=t;if(!function(e){if(!(e instanceof y&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(i.deleteThrottleMetadata(o),a)return wm.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw t}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?D(n,i.intervalMillis,Im):D(n,i.intervalMillis),l={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return i.setThrottleMetadata(o,l),wm.debug(`Calling attemptFetch again in ${u} millis`),km(e,l,r,i)}}class Am{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let Nm,Rm;async function Dm(e,t,n,r,i,s,o){var a;const c=Cm(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&wm.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>wm.error(e))),t.push(c);const u=async function(){if(!p())return wm.warn(_m.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await g()}catch(e){return wm.warn(_m.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[l,h]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(vm)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:Em}),r=document.createElement("script"),i=`${vm}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,l.measurementId),Rm&&(i("consent","default",Rm),Rm=void 0),i("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[gm]="firebase",d.update=!0,null!=h&&(d[pm]=h),i("config",l.measurementId,d),Nm&&(i("set",Nm),Nm=void 0),l.measurementId}class Pm{constructor(e){this.app=e}_delete(){return delete Om[this.app.options.appId],Promise.resolve()}}let Om={},Lm=[];const Mm={};let xm,Um,Fm="dataLayer",Vm=!1;function jm(e,t,n){!function(){const e=[];if(f()&&e.push("This is a browser extension environment."),m()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=_m.create("invalid-analytics-context",{errorInfo:t});wm.warn(n.message)}}();const r=e.options.appId;if(!r)throw _m.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw _m.create("no-api-key");wm.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Om[r])throw _m.create("already-exists",{id:r});if(!Vm){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Fm);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await bm(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){wm.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await bm(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){wm.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t]=s;e("consent","update",t)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){wm.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(Om,Lm,Mm,Fm,"gtag");Um=e,xm=t,Vm=!0}return Om[r]=Dm(e,Lm,Mm,t,xm,Fm,n),new Pm(e)}const Bm="@firebase/analytics",$m="0.10.0";ye(new O(fm,((e,{options:t})=>jm(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),ye(new O("analytics-internal",(function(e){try{const t=e.getProvider(fm).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=P(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Um,Om[e.app.options.appId],t,n,r).catch((e=>wm.error(e)))}(t,e,n,r)}}catch(e){throw _m.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Te(Bm,$m),Te(Bm,$m,"esm2017");const qm="@firebase/performance",zm="0.6.4",Km=zm,Hm="FB-PERF-TRACE-MEASURE",Gm="_wt_",Wm="_fcp",Qm="_fid",Jm="@firebase/performance/config",Xm="@firebase/performance/configexpire",Ym="Performance",Zm=new v("performance",Ym,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),ey=new z(Ym);let ty,ny,ry,iy;ey.logLevel=F.INFO;class sy{constructor(e){if(this.window=e,!e)throw Zm.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&m()?!!p()||(ey.info("IndexedDB is not supported by current browswer"),!1):(ey.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){this.PerformanceObserver&&new this.PerformanceObserver((e=>{for(const n of e.getEntries())t(n)})).observe({entryTypes:[e]})}static getInstance(){return void 0===ty&&(ty=new sy(ny)),ty}}function oy(){return ry}function ay(e,t){const n=e.length-t.length;if(n<0||n>1)throw Zm.create("invalid String merger input");const r=[];for(let n=0;n<e.length;n++)r.push(e.charAt(n)),t.length>n&&r.push(t.charAt(n));return r.join("")}class cy{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=ay("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=ay("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===iy&&(iy=new cy),iy}}var uy;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(uy||(uy={}));const ly=["firebase_","google_","ga_"],hy=new RegExp("^[a-zA-Z]\\w*$");function dy(){const e=sy.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function fy(){switch(sy.getInstance().document.visibilityState){case"visible":return uy.VISIBLE;case"hidden":return uy.HIDDEN;default:return uy.UNKNOWN}}function py(){const e=sy.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function gy(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.appId;if(!n)throw Zm.create("no app id");return n}const my="0.0.1",yy={loggingEnabled:!0},vy="FIREBASE_INSTALLATIONS_AUTH";const wy="Could not fetch config, will use default configs";function _y(e){if(!e)return e;const t=cy.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=yy.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):yy.logSource&&(t.logSource=yy.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:yy.logEndPointUrl&&(t.logEndPointUrl=yy.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:yy.transportKey&&(t.transportKey=yy.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==yy.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=yy.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==yy.tracesSamplingRate&&(t.tracesSamplingRate=yy.tracesSamplingRate),t.logTraceAfterSampling=Ey(t.tracesSamplingRate),t.logNetworkAfterSampling=Ey(t.networkRequestsSamplingRate),e}function Ey(e){return Math.random()<=e}let by,Iy=1;function Ty(e){return Iy=2,by=by||function(e){return function(){const e=sy.getInstance().document;return new Promise((t=>{if(e&&"complete"!==e.readyState){const n=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()}))}().then((()=>function(e){const t=e.getId();return t.then((e=>{ry=e})),t}(e.installations))).then((t=>function(e,t){const n=function(){const e=sy.getInstance().localStorage;if(!e)return;const t=e.getItem(Xm);if(!(t&&(n=t,Number(n)>Date.now())))return;var n;const r=e.getItem(Jm);if(r)try{return JSON.parse(r)}catch(e){return}}();return n?(_y(n),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then((e=>{})),t}(e.installations).then((n=>{const r=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!n)throw Zm.create("no project id");return n}(e.app),i=function(e){var t;const n=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!n)throw Zm.create("no api key");return n}(e.app),s=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${r}/namespaces/fireperf:fetch?key=${i}`,{method:"POST",headers:{Authorization:`${vy} ${n}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:n,app_id:gy(e.app),app_version:Km,sdk_version:my})});return fetch(s).then((e=>{if(e.ok)return e.json();throw Zm.create("RC response not ok")}))})).catch((()=>{ey.info(wy)}))}(e,t).then(_y).then((e=>function(e){const t=sy.getInstance().localStorage;e&&t&&(t.setItem(Jm,JSON.stringify(e)),t.setItem(Xm,String(Date.now()+60*cy.getInstance().configTimeToLive*60*1e3)))}(e)),(()=>{}))}(e,t))).then((()=>Sy()),(()=>Sy()))}(e),by}function Sy(){Iy=3}const Cy=1e4;let ky,Ay=3,Ny=[],Ry=!1;function Dy(e){setTimeout((()=>{if(0!==Ay)return Ny.length?void function(){const e=Ny.splice(0,1e3),t=e.map((e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})));(function(e,t){return function(e){const t=cy.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then((e=>(e.ok||ey.info("Call to Firebase backend failed."),e.json()))).then((e=>{const n=Number(e.nextRequestWaitMillis);let r=Cy;isNaN(n)||(r=Math.max(n,r));const i=e.logResponseDetails;Array.isArray(i)&&i.length>0&&"RETRY_REQUEST_LATER"===i[0].responseAction&&(Ny=[...t,...Ny],ey.info("Retry transport request later.")),Ay=3,Dy(r)}))})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:cy.getInstance().logSource,log_event:t},e).catch((()=>{Ny=[...e,...Ny],Ay--,ey.info(`Tries left: ${Ay}.`),Dy(Cy)}))}():Dy(Cy)}),e)}function Py(e,t){ky||(ky=function(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw Zm.create("invalid cc log");Ny=[...Ny,e]}({message:e(...t),eventTime:Date.now()})}}(My)),ky(e,t)}function Oy(e){const t=cy.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&sy.getInstance().requiredApisAvailable()&&(e.isAuto&&fy()!==uy.VISIBLE||(3===Iy?Ly(e):Ty(e.performanceController).then((()=>Ly(e)),(()=>Ly(e)))))}function Ly(e){if(!oy())return;const t=cy.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout((()=>Py(e,1)),0)}function My(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:xy(e.performanceController.app),network_request_metric:t};return JSON.stringify(n)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);const r={application_info:xy(e.performanceController.app),trace_metric:t};return JSON.stringify(r)}(e)}function xy(e){return{google_app_id:gy(e),app_instance_id:oy(),web_app_info:{sdk_version:Km,page_url:sy.getInstance().getUrl(),service_worker_status:dy(),visibility_state:fy(),effective_connection_type:py()},application_process_state:0}}const Uy=["_fp",Wm,Qm];class Fy{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=sy.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Hm}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Zm.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Zm.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Oy(this)}record(e,t,n){if(e<=0)throw Zm.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Zm.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const e of Object.keys(n.metrics))isNaN(Number(n.metrics[e]))||(this.counters[e]=Math.floor(Number(n.metrics[e])));Oy(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||n.length>100||!(r&&r.startsWith(Gm)&&Uy.indexOf(n)>-1)&&n.startsWith("_"))throw Zm.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=function(e){const t=Math.floor(e);return t<e&&ey.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const n=!(0===(r=e).length||r.length>40||ly.some((e=>r.startsWith(e)))||!r.match(hy));var r;const i=function(e){return 0!==e.length&&e.length<=100}(t);if(n&&i)this.customAttributes[e]=t;else{if(!n)throw Zm.create("invalid attribute name",{attributeName:e});if(!i)throw Zm.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){const i=sy.getInstance().getUrl();if(!i)return;const s=new Fy(e,Gm+i,!0),o=Math.floor(1e3*sy.getInstance().getTimeOrigin());if(s.setStartTime(o),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n){const e=n.find((e=>"first-paint"===e.name));e&&e.startTime&&s.putMetric("_fp",Math.floor(1e3*e.startTime));const t=n.find((e=>"first-contentful-paint"===e.name));t&&t.startTime&&s.putMetric(Wm,Math.floor(1e3*t.startTime)),r&&s.putMetric(Qm,Math.floor(1e3*r))}Oy(s)}static createUserTimingTrace(e,t){Oy(new Fy(e,t,!1,t))}}function Vy(e,t){const n=t;if(!n||void 0===n.responseStart)return;const r=sy.getInstance().getTimeOrigin(),i=Math.floor(1e3*(n.startTime+r)),s=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,o=Math.floor(1e3*(n.responseEnd-n.startTime));!function(e){const t=cy.getInstance();if(!t.instrumentationEnabled)return;const n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0];n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout((()=>Py(e,0)),0)}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:i,timeToResponseInitiatedUs:s,timeToResponseCompletedUs:o})}function jy(e){oy()&&(setTimeout((()=>function(e){const t=sy.getInstance(),n=t.getEntriesByType("navigation"),r=t.getEntriesByType("paint");if(t.onFirstInputDelay){let i=setTimeout((()=>{Fy.createOobTrace(e,n,r),i=void 0}),5e3);t.onFirstInputDelay((t=>{i&&(clearTimeout(i),Fy.createOobTrace(e,n,r,t))}))}else Fy.createOobTrace(e,n,r)}(e)),0),setTimeout((()=>function(e){const t=sy.getInstance(),n=t.getEntriesByType("resource");for(const t of n)Vy(e,t);t.setupObserver("resource",(t=>Vy(e,t)))}(e)),0),setTimeout((()=>function(e){const t=sy.getInstance(),n=t.getEntriesByType("measure");for(const t of n)By(e,t);t.setupObserver("measure",(t=>By(e,t)))}(e)),0))}function By(e,t){const n=t.name;n.substring(0,Hm.length)!==Hm&&Fy.createUserTimingTrace(e,n)}class $y{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),sy.getInstance().requiredApisAvailable()?g().then((e=>{e&&(Ry||(Dy(5500),Ry=!0),Ty(this).then((()=>jy(this)),(()=>jy(this))),this.initialized=!0)})).catch((e=>{ey.info(`Environment doesn't support IndexedDB: ${e}`)})):ey.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){cy.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return cy.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){cy.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return cy.getInstance().dataCollectionEnabled}}ye(new O("performance",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw Zm.create("FB not default");if("undefined"==typeof window)throw Zm.create("no window");!function(e){ny=e}(window);const i=new $y(n,r);return i._init(t),i}),"PUBLIC")),Te(qm,zm),Te(qm,zm,"esm2017");const qy=new Map,zy={activated:!1,tokenObservers:[]},Ky={initialized:!1,enabled:!1};function Hy(e){return qy.get(e)||Object.assign({},zy)}function Gy(){return Ky}const Wy="https://content-firebaseappcheck.googleapis.com/v1",Qy="exchangeDebugToken",Jy={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Xy{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=r,r>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch((()=>{}))}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new h,await(t=this.getNextRun(e),new Promise((e=>{setTimeout(e,t)}))),this.pending.resolve(),await this.pending.promise,this.pending=new h,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch((()=>{}))}catch(e){this.retryPolicy(e)?this.process(!1).catch((()=>{})):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}}const Yy=new v("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Zy(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function ev(e){if(!Hy(e).activated)throw Yy.create("use-before-activation",{appName:e.name})}function tv(e){const t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),s=t-3600*n*24-3600*r-60*i;let o="";return n&&(o+=nv(n)+"d:"),r&&(o+=nv(r)+"h:"),o+=nv(i)+"m:"+nv(s)+"s",o}function nv(e){return 0===e?"00":e>=10?e.toString():"0"+e}async function rv({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&(r["X-Firebase-Client"]=e)}const s={method:"POST",body:JSON.stringify(t),headers:r};let o,a;try{o=await fetch(e,s)}catch(e){throw Yy.create("fetch-network-error",{originalErrorMessage:null==e?void 0:e.message})}if(200!==o.status)throw Yy.create("fetch-status-error",{httpStatus:o.status});try{a=await o.json()}catch(e){throw Yy.create("fetch-parse-error",{originalErrorMessage:null==e?void 0:e.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Yy.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const u=1e3*Number(c[1]),l=Date.now();return{token:a.token,expireTimeMillis:l+u,issuedAtTimeMillis:l}}function iv(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Wy}/projects/${n}/apps/${r}:${Qy}?key=${i}`,body:{debug_token:t}}}const sv="firebase-app-check-database",ov=1,av="firebase-app-check-store",cv="debug-token";let uv=null;function lv(){return uv||(uv=new Promise(((e,t)=>{try{const n=indexedDB.open(sv,ov);n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{var n;t(Yy.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(av,{keyPath:"compositeKey"})}}catch(e){t(Yy.create("storage-open",{originalErrorMessage:null==e?void 0:e.message}))}})),uv)}async function hv(e,t){const n=(await lv()).transaction(av,"readwrite"),r=n.objectStore(av).put({compositeKey:e,value:t});return new Promise(((e,t)=>{r.onsuccess=t=>{e()},n.onerror=e=>{var n;t(Yy.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}}))}async function dv(e){const t=(await lv()).transaction(av,"readonly"),n=t.objectStore(av).get(e);return new Promise(((e,r)=>{n.onsuccess=t=>{const n=t.target.result;e(n?n.value:void 0)},t.onerror=e=>{var t;r(Yy.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}}))}function fv(e){return`${e.options.appId}-${e.name}`}const pv=new z("@firebase/app-check");function gv(e,t){return p()?function(e,t){return hv(fv(e),t)}(e,t).catch((e=>{pv.warn(`Failed to write token to IndexedDB. Error: ${e}`)})):Promise.resolve()}async function mv(){let e;try{e=await dv(cv)}catch(e){}if(e)return e;{const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return(t=e,hv(cv,t)).catch((e=>pv.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`))),e}var t}function yv(){return Gy().enabled}async function vv(){const e=Gy();if(e.enabled&&e.token)return e.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}const wv={error:"UNKNOWN_ERROR"};async function _v(e,t=!1){const n=e.app;ev(n);const r=Hy(n);let i,s=r.token;if(s&&!Sv(s)&&(r.token=void 0,s=void 0),!s){const e=await r.cachedTokenPromise;e&&(Sv(e)?s=e:await gv(n,void 0))}if(!t&&s&&Sv(s))return{token:s.token};let o,a=!1;if(yv()){r.exchangeTokenPromise||(r.exchangeTokenPromise=rv(iv(n,await vv()),e.heartbeatServiceProvider).finally((()=>{r.exchangeTokenPromise=void 0})),a=!0);const t=await r.exchangeTokenPromise;return await gv(n,t),r.token=t,{token:t.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally((()=>{r.exchangeTokenPromise=void 0})),a=!0),s=await Hy(n).exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?pv.warn(e.message):pv.error(e),i=e}return s?i?o=Sv(s)?{token:s.token,internalError:i}:Cv(i):(o={token:s.token},r.token=s,await gv(n,s)):o=Cv(i),a&&Tv(n,o),o}function Ev(e,t,n,r){const{app:i}=e,s=Hy(i),o={next:n,error:r,type:t};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Sv(s.token)){const t=s.token;Promise.resolve().then((()=>{n({token:t.token}),Iv(e)})).catch((()=>{}))}s.cachedTokenPromise.then((()=>Iv(e)))}function bv(e,t){const n=Hy(e),r=n.tokenObservers.filter((e=>e.next!==t));0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),n.tokenObservers=r}function Iv(e){const{app:t}=e,n=Hy(t);let r=n.tokenRefresher;r||(r=function(e){const{app:t}=e;return new Xy((async()=>{let n;if(n=Hy(t).token?await _v(e,!0):await _v(e),n.error)throw n.error;if(n.internalError)throw n.internalError}),(()=>!0),(()=>{const e=Hy(t);if(e.token){let t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5;const n=e.token.expireTimeMillis-3e5;return t=Math.min(t,n),Math.max(0,t-Date.now())}return 0}),Jy.RETRIAL_MIN_WAIT,Jy.RETRIAL_MAX_WAIT)}(e),n.tokenRefresher=r),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function Tv(e,t){const n=Hy(e).tokenObservers;for(const e of n)try{"EXTERNAL"===e.type&&null!=t.error?e.error(t.error):e.next(t)}catch(e){}}function Sv(e){return e.expireTimeMillis-Date.now()>0}function Cv(e){return{token:(t=wv,n.encodeString(JSON.stringify(t),!1)),error:e};var t}class kv{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Hy(this.app);for(const t of e)bv(this.app,t.next);return Promise.resolve()}}function Av(e,t){const n=new h;Hy(e).reCAPTCHAState={initialized:n};const r=function(e){const t=`fire_app_check_${e.name}`,n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}(e),i=Zy(!1);return i?Nv(e,t,i,r,n):function(i){const s=document.createElement("script");s.src="https://www.google.com/recaptcha/api.js",s.onload=()=>{const i=Zy(!1);if(!i)throw new Error("no recaptcha");Nv(e,t,i,r,n)},document.head.appendChild(s)}(),n.promise}function Nv(e,t,n,r,i){n.ready((()=>{!function(e,t,n,r){const i=n.render(r,{sitekey:t,size:"invisible",callback:()=>{Hy(e).reCAPTCHAState.succeeded=!0},"error-callback":()=>{Hy(e).reCAPTCHAState.succeeded=!1}}),s=Hy(e);s.reCAPTCHAState=Object.assign(Object.assign({},s.reCAPTCHAState),{widgetId:i})}(e,t,n,r),i.resolve(n)}))}class Rv{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t,n;!function(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Yy.create("throttled",{time:tv(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}(this._throttleData);const r=await async function(e){ev(e);const t=Hy(e).reCAPTCHAState,n=await t.initialized.promise;return new Promise(((t,r)=>{const i=Hy(e).reCAPTCHAState;n.ready((()=>{t(n.execute(i.widgetId,{action:"fire_app_check"}))}))}))}(this._app).catch((e=>{throw Yy.create("recaptcha-error")}));if(!(null===(e=Hy(this._app).reCAPTCHAState)||void 0===e?void 0:e.succeeded))throw Yy.create("recaptcha-error");let i;try{i=await rv(function(e,t){const{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Wy}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,r),this._heartbeatServiceProvider)}catch(e){throw(null===(t=e.code)||void 0===t?void 0:t.includes("fetch-status-error"))?(this._throttleData=function(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};{const n=t?t.backoffCount:0,r=D(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}}(Number(null===(n=e.customData)||void 0===n?void 0:n.httpStatus),this._throttleData),Yy.create("throttled",{time:tv(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,i}initialize(e){this._app=e,this._heartbeatServiceProvider=ve(e,"heartbeat"),Av(e,this._siteKey).catch((()=>{}))}isEqual(e){return e instanceof Rv&&this._siteKey===e._siteKey}}const Dv="app-check-internal";ye(new O("app-check",(e=>{return t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),new kv(t,n);var t,n}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider(Dv).initialize()}))),ye(new O(Dv,(e=>{return t=e.getProvider("app-check").getImmediate(),{getToken:e=>_v(t,e),getLimitedUseToken:()=>async function(e){const t=e.app;ev(t);const{provider:n}=Hy(t);if(yv()){const n=await vv(),{token:r}=await rv(iv(t,n),e.heartbeatServiceProvider);return{token:r}}{const{token:e}=await n.getToken();return{token:e}}}(t),addTokenListener:e=>Ev(t,"INTERNAL",e),removeTokenListener:e=>bv(t.app,e)};var t}),"PUBLIC").setInstantiationMode("EXPLICIT")),Te("@firebase/app-check","0.8.0");try{const Lv=be({apiKey:"AIzaSyCrXbgrgnkGFfPkbHdJ5oRD4ezbv5ypWbE",authDomain:"playmusichtml.firebaseapp.com",projectId:"playmusichtml",storageBucket:"playmusichtml.appspot.com",messagingSenderId:"485050816009",appId:"1:485050816009:web:c1630df9ed354c33d98ad8",measurementId:"G-DZ88CYJF8L"}),Mv=(function(e=Ie()){const t=ve(e=P(e),fm);t.isInitialized()?t.getImmediate():function(e,t={}){const n=ve(e,fm);if(n.isInitialized()){const e=n.getImmediate();if(_(t,n.getOptions()))return e;throw _m.create("already-initialized")}n.initialize({options:t})}(e)}(Lv),function(e=Ie()){ve(e=P(e),"performance").getImmediate()}(Lv),function(e=Ie(),t){const n=ve(e=P(e),"app-check");if(Gy().initialized||function(){const e=o(),t=Gy();if(t.initialized=!0,"string"!=typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN&&!0!==e.FIREBASE_APPCHECK_DEBUG_TOKEN)return;t.enabled=!0;const n=new h;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(mv())}(),yv()&&vv().then((e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`))),n.isInitialized()){const r=n.getImmediate(),i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Yy.create("already-initialized",{appName:e.name})}const r=n.initialize({options:t});(function(e,t,n){const r=function(e,t){return qy.set(e,t),qy.get(e)}(e,Object.assign({},zy));r.activated=!0,r.provider=t,r.cachedTokenPromise=async function(e){if(p()){let t;try{t=await function(e){return dv(fv(e))}(e)}catch(e){pv.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return t}}(e).then((t=>(t&&Sv(t)&&(r.token=t,Tv(e,{token:t.token})),t))),r.isTokenAutoRefreshEnabled=void 0===n?e.automaticDataCollectionEnabled:n,r.provider.initialize(e)})(e,t.provider,t.isTokenAutoRefreshEnabled),Hy(e).isTokenAutoRefreshEnabled&&Ev(r,"INTERNAL",(()=>{}))}(Lv,{provider:new Rv("6LfhO68oAAAAAH-9cGAU4C9VEZHm0gzxXmS0ubbw"),isTokenAutoRefreshEnabled:!0}),function(e=Ie()){const t=ve(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ve(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(_(n.getOptions(),null!=t?t:{}))return e;qe(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:vr,persistence:[Fn,En,In]}),r=l("authTokenSyncURL");if(r){const e=(i=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>br)return;const r=null==t?void 0:t.token;Ir!==r&&(Ir=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){P(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,i){P(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var i;const s=c("auth");return s&&function(e,t,n){const r=jt(e);Ge(r._canInitEmulator,r,"emulator-config-failed"),Ge(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=Ht(t),{host:o,port:a}=function(e){const t=Ht(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Gt(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Gt(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${s}`),n}()),xv=function(e,t){const n="string"==typeof e?e:"(default)",r=ve("object"==typeof e?e:Ie(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=(e=>{const t=c("firestore");if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]})();e&&function(e,t,n,r={}){var s;const o=(e=dp(e,pp))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Xa("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ka.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new rc(nc.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ka(o)}e._authCredentials=new ac(new sc(t,n))}}(r,...e)}return r}(Lv),Uv=document.getElementById("reset-email"),Fv=document.getElementById("resetbutton"),Vv=document.getElementById("login-form"),jv=document.getElementById("login-email"),Bv=document.getElementById("login-password"),$v=document.getElementById("signup-form"),qv=document.getElementById("signup-email"),zv=document.getElementById("signup-password"),Kv=document.getElementById("logout-button"),Hv=document.getElementById("savebutton"),Gv=document.getElementById("githubuttonlogin");var Pv=document.getElementById("createplaylist"),Ov=document.getElementById("myAudio");function Wv(e){e.preventDefault(e);const t=new un;(async function(e,t,n){const r=jt(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&qe(e,"argument-error"),Ke(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,sn);const i=jn(r,void 0);return new Gn(r,"signInViaPopup",t,i).executeNotNull()})(Mv,t).then((async e=>{const n=un.credentialFromResult(e);return console.log(n.accessToken,"data"),setLoader((e=>({...e,githubLoading:!1}))),n.accessToken,e.user,e=await async function(e,t){return await jt(e)._initializationPromise,Yn(e,void 0,!1)}(Mv),null===e||null===t.credentialFromResult(e)?null:e})).catch((e=>{e.code,e.message,e.customData.email,un.credentialFromError(e)}))}function Qv(e){e.preventDefault();const t=jv.value,n=Bv.value;(function(e,t,n){return async function(e,t){return mn(jt(e),t)}(P(e),rn.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&yn(e),t}))})(Mv,t,n).then((e=>{const t=e.user;alert("Logged in as: "+t.email),window.location.href="./"})).catch((e=>{alert("Login error: "+e.message)}))}function Jv(e){e.preventDefault();const t=Uv.value;(async function(e,t,n){var r;const i=jt(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await Kt(i,s,"getOobCode",!0);await Jt(i,e)}else await Jt(i,s).catch((async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);{console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");const e=await Kt(i,s,"getOobCode",!0);await Jt(i,e)}}))})(Mv,t).then((()=>{alert("Password reset email sent. Check your inbox.")})).catch((e=>{alert("Error sending password reset email: "+e.message)}))}function Xv(e){e.preventDefault();const t=qv.value,n=zv.value;(async function(e,t,n){var r;const i=jt(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(r=i._getRecaptchaConfig())||void 0===r?void 0:r.emailPasswordEnabled){const e=await Kt(i,s,"signUpPassword");o=hn(i,e)}else o=hn(i,s).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await Kt(i,s,"signUpPassword");return hn(i,e)}throw e}));const a=await o.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&yn(e),t})),c=await dn._fromIdTokenResponse(i,"signIn",a);return await i._updateCurrentUser(c.user),c})(Mv,t,n).then((e=>{let t=Mv.currentUser;alert("Signed up:",t),window.location.reload(),window.location.href="https://sillyangel.me/"})).catch((e=>{alert("Signup error:",e.message)}))}function Yv(e){e.preventDefault(),function(e){return P(e).signOut()}(Mv).then((()=>{alert("Log Out"),window.location.href="https://sillyangel.me/"})).catch((e=>{alert("a error happened when loging out",e.message)}))}async function Zv(){const e=prompt("Name of new playlist?"),t=prompt("URL for the playlist image"),n=Mv.currentUser;if(e&&t)if(n.uid){const r=n.uid,i={name:e,imageUrl:t},s=vp(xv,"playlists");try{await function(e,t){const n=dp(e.firestore,_p),r=function(e,t,...n){if(e=P(e),1===arguments.length&&(t=pc.V()),cp("doc","path",t),e instanceof pp){const r=_c.fromString(t,...n);return up(r),new mp(e,null,new Ic(r))}{if(!(e instanceof mp||e instanceof yp))throw new rc(nc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_c.fromString(t,...n));return up(r),new mp(e.firestore,e instanceof yp?e.converter:null,new Ic(r))}}(e),i=function(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}(e.converter,t);return ug(n,[Op(Pp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Ml.exists(!1))]).then((()=>r))}(s,{userId:r,data:i}),alert("Playlist data saved in Firestore.")}catch(e){alert("Error adding playlist data: "+e.message)}}else alert("You need to be logged in to create a playlist.")}async function ew(e){if(e){const t=e.uid,n=Wp(vp(xv,"playlists"),Jp("userId","==",t));try{const e=await cg(n);e.empty?console.log("User doesn't have a playlist."):e.forEach((e=>{const t=e.data().data,n=t.name,r=document.createElement("div");r.id=n,r.classList.add("playlist-item"),r.style.display="none";const i=document.createElement("img");i.src=t.imageUrl;const s=document.createElement("h2");s.textContent=n+" - Playlist",document.createElement("br"),document.createElement("br");const o=document.createElement("br"),a=document.createElement("br"),c=document.createElement("br"),u=document.createElement("button");u.id="exitbutton",u.textContent="Exit",u.addEventListener("click",(()=>{r.style.display="none",document.getElementById("lilbrary").style.display="flex"}));const l=document.createElement("button");l.textContent="Delete",l.id="deletebutton",l.addEventListener("click",(async()=>{try{await(t=e.ref,ug(dp(t.firestore,_p),[new Wl(t._key,Ml.none())])),document.body.removeChild(r)}catch(e){console.error("Error deleting playlist:",e)}var t})),r.appendChild(s),r.appendChild(u),r.appendChild(l),r.appendChild(o),r.appendChild(i),r.appendChild(a),r.appendChild(c),document.body.appendChild(r);const h=document.createElement("button"),d=document.createElement("img");d.src=t.imageUrl,d.alt=n,h.addEventListener("click",(()=>{document.querySelectorAll(".playlist-item").forEach((e=>{e.style.display="none"})),r.style.display="flex",document.getElementById("lilbrary").style.display="none"})),h.appendChild(d),playlistContainer.appendChild(h)}))}catch(e){console.error("Error checking for playlist:",e)}}else console.log("User is not authenticated.")}async function tw(){const e=document.getElementById("displayname").value,t=document.getElementById("PhotoUrl").value;(async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=P(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await ft(r,async function(e,t){return it(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)})(Mv.currentUser,{displayName:e,photoURL:t}).then((()=>{console.log("Updated Profile Details")})).catch((e=>{alert("a error happened when updatingProfile out ",e.message)}))}Vv.addEventListener("submit",Qv),$v.addEventListener("submit",Xv),Kv.addEventListener("click",Yv),Fv.addEventListener("click",Jv),Gv.addEventListener("click",Wv),Pv.addEventListener("click",Zv),new MutationObserver((function(e){e.forEach((function(e){"src"===e.attributeName&&(console.log("Current Track Index:",currentTrackIndex),console.log("Current Album Index:",currentAlbumIndex))}))})).observe(Ov,{attributes:!0}),Mv.onAuthStateChanged((async e=>{if(e){const t=e.uid,n=Wp(vp(xv,"playlists"),Jp("userId","==",t));try{const t=await cg(n);t.empty?console.log("User doesn't have a playlist."):(t.forEach((e=>{const t=e.data();console.log("Loaded playlist:",t)})),ew(e))}catch(e){console.error("Error checking for playlist:",e)}}else console.log("User is not authenticated.")})),Mv.onAuthStateChanged((async e=>{if(e){const t=document.getElementById("username");document.getElementById("lisuf"),t.innerHTML="",t.innerHTML=`${e.displayName}`}else document.getElementById("username").innerHTML="Not Logged In"})),Mv.onAuthStateChanged((async e=>{if(e){const o=document.getElementById("accountmainbutton");var t=document.getElementById("songselector"),n=document.getElementById("searching"),r=document.getElementById("lilbrary"),i=document.getElementById("mlogin"),s=document.getElementById("accountsettings");function a(){t.style.display="none",n.style.display="none",r.style.display="none",i.style.display="none",s.style.display="block"}o.onclick=a}})),Hv.onclick=tw}catch(nw){alert(nw.message),alert(nw),console.log(nw.message),console.log(nw)}})();